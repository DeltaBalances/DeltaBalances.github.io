!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).bundle=e()}}((function(){const e=require("bignumber.js"),t=require("/ethersWrapper.js").utils.defaultAbiCoder,a=require("/ethersWrapper.js").utils.Fragment,n=require("/ethersWrapper.js").utils.id,r={savedABIs:[],methodIDs:{}};function o(e){if(e.name)return e.name+"("+s(e.inputs,!1)+")";throw new Error("Expected a function or event name")}function s(e,t){return(e=e.map((function(e){if(-1===e.type.indexOf("tuple"))return e.type;{let a="("+s(e.components,t)+")";t&&(a="tuple"+a);let n=e.type.length-5;for(;n>=2;)a+="[]",n-=2;return a}}))).join(",")}function i(e){return e.map((function(e){return-1===e.type.indexOf("tuple")?e.type:s([e],!0)}))}var l,u={getABIs:function(){return r.savedABIs},addABI:function(e){if(!Array.isArray(e))throw new Error("Expected ABI array, got "+typeof e);e.map((function(e){if("string"==typeof e)try{let t=a.fromString(e).format("json");e=JSON.parse(t)}catch(t){e={}}if(e.name){const t=n(o(e));"event"==e.type?r.methodIDs[t.slice(2)]=e:r.methodIDs[t.slice(2,10)]=e}})),r.savedABIs=r.savedABIs.concat(e)},getMethodIDs:function(){return r.methodIDs},decodeMethod:function(a){const n=a.slice(2,10),o=r.methodIDs[n];if(o){const n=i(o.inputs);let r=t.decode(n,"0x"+a.slice(10));return delete r.__length__,r=Object.values(r),{name:o.name,params:r.map((function(t,a){let n=t,r=o.inputs[a].type;const s=0==r.indexOf("uint"),i=0==r.indexOf("int"),l=0==r.indexOf("tuple");function u(t){return Array.isArray(t)?t.map(e=>u(e)):new e(t).toString()}return s||i?n=u(t):l&&(n=function e(t,n,r){return n>0?t.map(t=>e(t,n-1)):t.map((function(t,n){let s=void 0,i=(s=r?r.components[n]:o.inputs[a].components[n]).type;return 0==i.indexOf("uint")||0==i.indexOf("int")?t=u(t):0==i.indexOf("tuple")&&(t=e(t,(i.match(/]/g)||[]).length,s)),{name:o.inputs[a].components[n].name,value:t,type:o.inputs[a].components[n].type}}))}(n,(r.match(/]/g)||[]).length)),{name:o.inputs[a].name,value:n,type:o.inputs[a].type}}))}}},decodeLogs:function(a){return a.filter(e=>e.topics.length>0).map(a=>{const n=a.topics[0].slice(2);let o=r.methodIDs[n];if(o){const n=a.topics.length-1,r=o.inputs.reduce((e,t)=>e+(t.indexed?1:0),0),s=[];let l=-1;if(n>r){let e=n-r;for(let t=0;t<o.inputs.length;t++){if(!o.inputs[t].indexed){let a=o.inputs[t].name;"token"!=a&&"user"!=a&&"tokenGet"!=a&&"tokenGive"!=a&&"get"!=a&&"give"!=a&&"src"!=a&&"dst"!=a&&"wad"!=a&&"guy"!=a||(s.push(t),o.inputs[t].indexed=!0,e--)}if("Transfer"!=o.name&&"Approval"!=o.name||"wad"!=o.inputs[t].name||3!=n||2!=r||(o.inputs[t].name="tokenId",l=t),e<=0)break}}else if(r>n){let e=r-n;for(let t=o.inputs.length-1;t>=0;t--){if(o.inputs[t].indexed){let a=o.inputs[t].name;"token"!=a&&"user"!=a&&"tokenGet"!=a&&"tokenGive"!=a&&"get"!=a&&"give"!=a&&"src"!=a&&"dst"!=a&&"wad"!=a&&"guy"!=a||(s.push(t),o.inputs[t].indexed=!1,e--)}if("Transfer"!=o.name&&"Approval"!=o.name||"wad"!=o.inputs[t].name||0!=n||2!=r||(o.inputs[t].name="tokenId",l=t),e<=0)break}}const u=a.data;let d=[],m=0,c=1,h=[];o.inputs.map((function(e){if(!e.indexed){let t=i([e])[0];h.push(t)}}));const v=t.decode(h,u);if(o.inputs.map((function(t){var n={name:t.name,type:t.type};t.indexed?(n.value=a.topics[c],c++):(n.value=v[m],m++),"address"==t.type?n.value=function(e){var t=e;if(-1!=e.indexOf("0x")&&(t=e.slice(2)),t.length<40)for(;t.length<40;)t="0"+t;return"0x"+t}(new e(n.value).toString(16)):"uint256"!=t.type&&"uint8"!=t.type&&"int"!=t.type||(n.value=new e(n.value).toString(10)),d.push(n)})),s.length>0)for(let e=0;e<s.length;e++){let t=s[e];o.inputs[t].indexed=!o.inputs[t].indexed}return-1!==l&&"tokenId"==o.inputs[l].name&&(o.inputs[l].name="wad"),{name:o.name,events:d,address:a.address,blockNumber:a.blockNumber,hash:a.transactionHash}}})},removeABI:function(e){if(!Array.isArray(e))throw new Error("Expected ABI array, got "+typeof e);e.map((function(e){if(e.name){const t=n(o(e));"event"==e.type?r.methodIDs[t.slice(2)]&&delete r.methodIDs[t.slice(2)]:r.methodIDs[t.slice(2,10)]&&delete r.methodIDs[t.slice(2,10)]}}))}};const d=require("/ethersWrapper.js"),m=require("bignumber.js");m.config({ERRORS:!1}),l=e=>{const t={toBigNumber:function(e){const t=String(e);return new m(t)},weiToEth:function(e,t){const a=t||1e18;return this.toBigNumber(e).div(a)},weiToToken:function(e,t){let a=this.toBigNumber(1e18);return t&&void 0!==t.decimals&&(a=this.toBigNumber(Math.pow(10,t.decimals))),this.toBigNumber(e).div(a)},isAddress:function(e){if(e&&42==e.length)try{return d.utils.getAddress(e),!0}catch(e){}return!1},addressFromString:function(e){if(!e)return"";if(e=(e=e.toLowerCase().trim()).replace(/\./g," "),this.isAddress(e))return e;if(40==e.length&&"0x"!==e.slice(0,2)){let t="0x"+e;if(this.isAddress(t))return t}if(-1!==e.indexOf("0x")&&-1===e.indexOf("/tx")){let t=["/0x","=0x","#0x"],a=-1,n="";for(let r=0;r<t.length;r++)if(-1!=(a=e.indexOf(t[r]))){n=t[r];break}if(n){let t=Math.min(42,e.length-a),n=e.slice(a+1,a+1+t);if(this.isAddress(n))return n}}return""},hashFromString:function(e){if(!e)return"";if(66==(e=(e=e.toLowerCase().trim()).replace(/\./g," ")).length&&"0x"===e.slice(0,2))return e;if(64==e.length&&"0x"!==e.slice(0,2))return"0x"+e;if(-1!==e.indexOf("0x")){let t=["/0x","=0x","#0x"],a=-1,n="";for(let r=0;r<t.length;r++)if(-1!=(a=e.indexOf(t[r]))){n=t[r];break}if(n){let t=Math.min(66,e.length-a),n=e.slice(a+1,a+1+t);if(66==n.length&&"0x"===n.slice(0,2))return n}}return""},isWrappedETH:function(t){return!!t&&(t=t.toLowerCase(),1===e.config.wrappedETH[t])},isNonEthBase:function(t){return!(!t||(t=t.toLowerCase(),!e.config.baseToken[t]))&&e.config.baseToken[t]},relayName:function(t,a="0x"){let n="";return t&&(t=t.toLowerCase(),(n=e.config.zrxRelayers[t])||(n=e.config.zrxTakers[t]),n||(n=e.config.admins[t]),n||(n="Unknown "+a)),n&&-1!==n.indexOf(" Admin")&&(n=n.replace(" Admin","")),n},hasAdminWithdraw:function(t){if(t){let a=t.toLowerCase();return a==e.config.exchangeContracts.Idex.addr||a==e.config.exchangeContracts.Switcheo.addr||a==e.config.exchangeContracts.Switcheo2.addr||a==e.config.exchangeContracts.Joyso.addr||a==e.config.exchangeContracts.DexBlue2.addr}return!1},hasDepositFallback:function(t){if(t){let a=t.toLowerCase();return a==e.config.exchangeContracts.DexBlue.addr||a==e.config.exchangeContracts.DexBlue2.addr}return!1},exportNotation:function(e){return(e=this.toBigNumber(e).toFixed(20)).replace(/([0-9]+(\.[0-9]+[1-9])?)(\.?0+$)/,"$1")},displayNotation:function(e,t){return e=(e=this.toBigNumber(e)).greaterThan(1e9)?e.toExponential(t):e.toFixed(t),this.commaNotation(e)},commaNotation:function(e){var t=e.toString(),a=t.indexOf(".");return t.replace(/\d(?=(?:\d{3})+(?:\.|$))/g,(function(e,t){return a<0||t<a?e+",":e}))},getURL:function(e,t){jQuery.get(e).done(e=>{e?t(void 0,e):t("error retrieving url",void 0)}).fail((e,a,n)=>{t(n,void 0)})},postURL:function(e,t,a){jQuery.post(e,t).done(e=>{e?a(void 0,e):a("error post url",void 0)}).fail((e,t,n)=>{a(n,void 0)})},escapeHtml:function(e){if(!e)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(function(e){return t[e]}))},readFile:function(a,n){if(n)try{t.getURL(`${e.config.homeURL}/${a}`,(e,t)=>{e?n(e,void 0):n(void 0,t)})}catch(e){n(e,void 0)}},processLogs:function(t){if(e.config.methodIDS||this.initABIs(),t)if(t.constructor!==Array){t=[t];try{return a(u.decodeLogs(t))}catch(e){return void console.log("error in decodeLogs "+e)}}else try{return a(u.decodeLogs(t))}catch(e){return void console.log("error in decodeLogs "+e)}function a(t){let a=[];for(let n=0;n<t.length;n++){let r=t[n];if(r)if(r.address!==e.config.exchangeContracts.Ethen.addr)a.push(r);else if("Order"===r.name&&8==r.events.length){let o=n+1;for(;o<t.length&&t[o].hash===t[n].hash;){let a=t[o];if(a&&a.address===e.config.exchangeContracts.Ethen.addr&&"Trade"===a.name){r.combinedEvents=[a.events[0],a.events[2],a.events[3]];break}o++}r.combinedEvents&&a.push(r)}else a.push(r)}return a}},processInput:function(t){if(e.config.methodIDS||this.initABIs(),t)try{return u.decodeMethod(t)}catch(e){return void console.log("error in decodeMethod "+e)}},initABIs:function(){let t=Object.values(e.config.ABIs);for(let e=0;e<t.length;e++)u.addABI(t[e]);e.config.methodIDS=!0},etherDeltaURL:function(e,t){if(e){var a="https://etherdelta.com/#",n="label-warning";e.EtherDelta?(a+=e.EtherDelta+"-ETH",n="label-primary"):a+=e.addr+"-ETH"}else a="";return t&&(a='<a class="label '+n+'" href="'+a+'" target="_blank">EtherDelta <i class="fa fa-external-link" aria-hidden="true"></i></a>'),a},forkDeltaURL:function(e,t){var a="https://forkdelta.app/#!/trade/",n="label-warning";return e?e.ForkDelta?(a+=e.ForkDelta+"-ETH",n="label-primary"):a+=e.addr+"-ETH":a="",t&&(a='<a class="label '+n+'" href="'+a+'" target="_blank">ForkDelta <i class="fa fa-external-link" aria-hidden="true"></i></a>'),a},tokenStoreURL:function(e,t){var a="https://token.store/trade/",n="label-warning";return e?(e.TokenStore&&(n="label-primary"),a+=e.addr):a="",t&&(a='<a class="label '+n+'" href="'+a+'" target="_blank">Token store <i class="fa fa-external-link" aria-hidden="true"></i></a>'),a},oneInchUrl:function(e,t){let a="";return e&&e.OneInch&&(a="https://1inch.exchange/#/r/0xf6E914D07d12636759868a61E52973d17ED7111B"),t&&(a=""==a?'<span class="label label-default">1inch</span>':'<a class="label label-primary" href="'+a+'" target="_blank" rel="noopener noreferrer">1inch <i class="fa fa-external-link" aria-hidden="true"></i></a>'),a},idexURL:function(e,t){var a="https://idex.market/eth/",n="label-primary";return e&&e.IDEX&&!e.blockIDEX?a+=e.IDEX:(a="",n="label-default"),t&&(a=""==a?'<span class="label '+n+'">IDEX</span>':'<a class="label '+n+'" href="'+a+'" target="_blank">IDEX <i class="fa fa-external-link" aria-hidden="true"></i></a>'),a},ddexURL:function(e,t){let a="https://",n="",r="label-primary";return e&&(e.DDEX||e.DDEX2)?e.DDEX2?a+="ddex.io/spot/"+e.DDEX2:(a+="legacy.ddex.io/trade/"+e.DDEX+"-ETH",n=" legacy"):(r="label-default",a=""),t&&(a=""==a?'<span class="label '+r+'">DDEX</span>':'<a class="label '+r+'" href="'+a+'" target="_blank">DDEX'+n+'<i class="fa fa-external-link" aria-hidden="true"></i></a>'),a},binanceURL:function(e,t){var a="https://www.binance.com/trade.html?ref=10985752&symbol=",n="label-primary";return e&&e.Binance&&-1!==e.Binance.indexOf("ETH")?a+=e.Binance.replace("ETH","_ETH"):e&&e.Binance&&-1!==e.Binance.indexOf("BTC")?a+=e.Binance.replace("BTC","_BTC"):(n="label-default",a=""),t&&(a=""==a?'<span class="label '+n+'">Binance</span>':'<a class="label '+n+'" href="'+a+'" target="_blank">Binance <i class="fa fa-external-link" aria-hidden="true"></i></a>'),a},radarURL:function(e,t){var a="https://app.radarrelay.com/",n="label-primary";return e&&e.Radar?a+=e.Radar+"/WETH":(n="label-default",a=""),t&&(a=""==a?'<span class="label '+n+'">RadarRelay</span>':'<a class="label '+n+'" href="'+a+'" target="_blank">RadarRelay <i class="fa fa-external-link" aria-hidden="true"></i></a>'),a},kyberURL:function(e,t){var a="https://kyber.network/swap/eth_",n="label-primary";return e&&e.Kyber?a+=e.Kyber.toLowerCase():(n="label-default",a=""),t&&(a=""==a?'<span class="label '+n+'">Kyber</span>':'<a class="label '+n+'" href="'+a+'" target="_blank">Kyber <i class="fa fa-external-link" aria-hidden="true"></i></a>'),a},hashLink:function(e,t,a){var n="https://etherscan.io/tx/"+e;if(!t)return n;let r=e;return a&&(r=r.slice(0,8)+".."),'<a target = "_blank" href="'+n+'">'+r+" </a>"},addressLink:function(t,a,n,r){let o="https://etherscan.io/address/"+t;if(!a)return o;let s=t;if(n)s=s.slice(0,6)+"..";else if(r?(s=r,!n&&t&&(s=s+" "+t.toLowerCase())):s=e.addressName(t,!n),a&&!n&&s&&s!==t){let e=s.split(" "),t=!1;for(let a=0;a<e.length;a++)42==e[a].length&&"0x"==e[a].slice(0,2)&&(e[a]='<span class="dim">'+e[a]+"</span>",t=!0);t&&(s=e.join(" "))}return'<a target="_blank" href="'+o+'">'+s+" </a>"},tokenLink:function(t,a,n,r){var o="https://etherscan.io/token/"+t;if(r&&(o+="?a="+r),!a)return o;return'<a target="_blank" href="'+o+'">'+(n?t.slice(0,6)+"..":e.addressName(t,!n))+" </a>"},getBatchedBalances:function(e,a,n,r){try{e.functions[a](...n).then(e=>{let a=e[0];a=a.map(e=>t.toBigNumber(e)),r(void 0,a)},e=>{r(e,void 0)})}catch(e){}},getTradeLogs:function(a,n,r,o,s,i){Array.isArray(n)||(n=[n]);const l=JSON.stringify([{fromBlock:"0x"+t.decToHex(r),toBlock:"0x"+t.decToHex(o),address:a,topics:n}]);let u={start:r,end:o,count:o-r+1,retries:0,error:!1};function d(e){u.error=!0,u.splitRetry=!1,u.abort=!1,-32005==e?u.splitRetry=!0:e<-32600&&(u.abort=!0),i(void 0,u)}jQuery.ajax({headers:{Accept:"*/*","Content-Type":"application/json"},type:"POST",async:!0,url:e.config.infuraURL,data:'{"jsonrpc":"2.0","method":"eth_getLogs","params":'+l+' ,"id":'+s+"}",dataType:"json",timeout:55e3}).done(e=>{e&&e.jsonrpc?e.result&&Array.isArray(e.result)?i(e.result,u):e.error&&e.error.code?(console.log(e.error),d(e.error.code)):d():d()}).fail(e=>{d()})},txReceipt:function(a,n){e.provider.getTransactionReceipt(a).then(e=>{e&&e.blockNumber?(e.cumulativeGasUsed=t.toBigNumber(e.cumulativeGasUsed),e.gasUsed=t.toBigNumber(e.gasUsed),n(void 0,e)):n("empty receipt",void 0)},e=>{n(e,void 0)})},getTransaction:function(a,n){e.provider.getTransaction(a).then(e=>{e?(e.gasPrice=t.toBigNumber(e.gasPrice),e.gasLimit=t.toBigNumber(e.gasLimit),e.value=t.toBigNumber(e.value),e.data?e.input=e.data:e.input&&(e.data=e.input),n(void 0,e)):n("tx not found",void 0)},e=>{n(e,void 0)})},loadContract:function(t,a,n){if(t&&t.length>0){let r=void 0;try{if(!(r=new d.Contract(a,t,e.provider)))throw"fail"}catch(e){n("Ethers failed to load contract ",void 0)}n(void 0,r)}else n("no abi ",void 0)},getBlockDate:function(t,a){e.provider.getBlock(t).then(e=>{let n=e.timestamp||e.timeStamp;a(void 0,n,t)},e=>{a("failed to get date",void 0,t)})},blockNumber:function(t){e.provider.getBlockNumber().then(e=>{t(void 0,e)},e=>{t(err,void 0)})},decToHex:function(e,a){let n=a;if(n||(n=32),e<0)return this.toBigNumber(2).pow(n).add(this.toBigNumber(e)).toString(16);let r=null;try{r=t.convertBase(e.toString(),10,16)}catch(e){r=null}return r||this.toBigNumber(e).toString(16)},hexToDec:function(e,a){let n=e;if("0x"===n.substring(0,2)&&(n=n.substring(2)),n=n.toLowerCase(),!a)return t.convertBase(n,16,10);const r=Math.pow(2,a),o=t.convertBase(n,16,10);return o>r/2?r:o},convertBase:function(e,a,n){const r=t.parseToDigitsArray(e,a);if(null===r)return null;let o=[],s=[1];for(let e=0;e<r.length;e+=1)r[e]&&(o=t.add(o,t.multiplyByNumber(r[e],s,n),n)),s=t.multiplyByNumber(a,s,n);let i="";for(let e=o.length-1;e>=0;e-=1)i+=o[e].toString(n);return""===i&&(i=0),i},parseToDigitsArray:function(e,t){const a=e.split(""),n=[];for(let e=a.length-1;e>=0;e-=1){const r=parseInt(a[e],t);if(isNaN(r))return null;n.push(r)}return n},add:function(e,t,a){const n=[],r=Math.max(e.length,t.length);let o=0,s=0;for(;s<r||o;){const r=o+(s<e.length?e[s]:0)+(s<t.length?t[s]:0);n.push(r%a),o=Math.floor(r/a),s+=1}return n},multiplyByNumber:function(e,a,n){let r=e;if(r<0)return null;if(0===r)return[];let o=[],s=a;for(;1&r&&(o=t.add(o,s,n)),0!=(r>>=1);)s=t.add(s,s,n);return o},toDateTime:function(e){var t=e,a=new Date(0);return a.setUTCSeconds(t),a},toDateTimeNow:function(e){return new Date},createUTCOffset:function(e){if(!e)return"";function t(e){return e<10?"0"+e:e}var a=e.getTimezoneOffset()>0?"-":"+",n=Math.abs(e.getTimezoneOffset());return a+t(Math.floor(n/60))+":"+t(n%60)},formatDateOffset:function(e,a){return"??"==e?"??":a?t.formatDate(e,a):t.formatDateT(e,a)+t.createUTCOffset(e)},formatDate:function(e,t,a){if("??"==e)return"??";try{var n=""+(e.getMonth()+1),r=""+e.getDate(),o=e.getFullYear(),s=e.getHours(),i=e.getMinutes(),l=e.getSeconds();return n.length<2&&(n="0"+n),r.length<2&&(r="0"+r),s<10&&(s="0"+s),i<10&&(i="0"+i),l<10&&(l="0"+l),t?[o,n,r].join(""):a?[o,n,r].join("-")+" "+[s,i].join(":"):[o,n,r].join("-")+" "+[s,i,l].join(":")}catch(t){return e}},formatDateT:function(e,t){if("??"==e)return"??";try{var a=""+(e.getMonth()+1),n=""+e.getDate(),r=e.getFullYear(),o=e.getHours(),s=e.getMinutes(),i=e.getSeconds();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),o<10&&(o="0"+o),s<10&&(s="0"+s),i<10&&(i="0"+i),t?[r,a,n].join(""):[r,a,n].join("-")+"T"+[o,s,i].join(":")}catch(t){return e}},getWeb3Address:function(e,a){if("https:"===location.protocol||"http:"===location.protocol)if(void 0!==window.ethereum){if(window.ethereum.on("accountsChanged",(function(e){if(e&&e.length>0){let t=e[0].toLowerCase();metamaskAddr&&t!==metamaskAddr&&a(t,!0)}})),window.ethereum.selectedAddress&&t.isAddress(window.ethereum.selectedAddress))return void a(window.ethereum.selectedAddress.toLowerCase());e?ethereum.enable().then((function(e){e&&void 0!==e&&e.length>0?a(e[0],toLowerCase()):a("")}),(function(e){e&&(4001==e.code||"string"==typeof e&&e.indexOf("denied")>=0||e.message&&e.message.indexOf("denied")>=0)?console.log("rejected ethereum connection"):console.log("ethereum connection failed"),a("")})):a("")}else if(window&&void 0!==window.web3)try{new d.providers.Web3Provider(window.web3.currentProvider).getSigner().getAddress().then(e=>{a(e.toLowerCase())},e=>{throw"web3 detect failed"})}catch(e){console.log("web3 wallet detect exception"),a("")}else a("");else console.log("Metamask needs page to be hosted.")}};return t};let c=require("/config.js");const h=require("/ethersWrapper.js");require("bignumber.js").config({ERRORS:!1});const v=new g,p=l(v);function g(){this.uniqueTokens={},this.connection=void 0,this.secondsPerBlock=14,this.provider=h.getDefaultProvider("homestead",{etherscan:c.etherscanAPIKey,infura:c.infuraKey,quorum:2}),this.contractDeltaBalance=void 0,this.socket=null,this.socketConnected=!1,this.config=c,this.binanceMap={}}return g.prototype.socketTicker=function(e,t){let a=this;function n(){a.socket.emit("getMarket",{}),a.socket.once("market",a=>{e(null,a.returnTicker,t)})}a.socketConnected?n():a.connectSocket(()=>{n()})},g.prototype.connectSocket=function(e,t){let a=this,n=this.config.socketURL;this.socket=io.connect(n,{transports:["websocket"],reconnection:!0,reconnectionDelay:250,reconnectionAttempts:5}),this.socket.on("connect",()=>{console.log("socket connected"),a.socketConnected=!0,e&&e()}),this.socket.on("disconnect",()=>{a.socketConnected=!1,console.log("socket disconnected")}),t&&(this.socket.on("orders",e=>{t("orders",e)}),this.socket.on("funds",e=>{t("funds",e)}),this.socket.on("trades",e=>{t("trades",e)}))},g.prototype.dialogInfo=function(e){console.log(e)},g.prototype.dialogError=function(e){console.log(e)},g.prototype.alertSuccess=function(e){console.log(e)},g.prototype.addressLink=function(e){return p.addressLink(e,!1,!1)},g.prototype.divisorFromDecimals=function(e){var t=1e18;return void 0!==e&&(t=Math.pow(10,e)),p.toBigNumber(t)},g.prototype.loadWeb3=function(e,t){this.config=c;let a=!1;p.blockNumber((e,n)=>{if(!e&&n){const e=Number(n);e>blocknum&&(blocknum=e,console.log("block: "+e)),a||(a=!0,t())}}),setTimeout((function(){a||(console.log("Web3 timed out"),a=!0,t())}),2e3)},g.prototype.initContracts=function(e){let t=this;this.config=c,p.loadContract(t.config.ABIs.DeltaBalances,t.config.DeltaBalanceAddr,(a,n)=>{t.contractDeltaBalance=n,e()})},g.prototype.initTokens=function(e){let t=Object.keys(smartRelays).map(e=>e.toLowerCase()),a=Object.values(smartRelays);for(var n=0;n<a.length;n++)if(!this.uniqueTokens[t[n]]){let e={addr:t[n],name:a[n],decimals:18,unlisted:!0,blocked:2};this.uniqueTokens[e.addr]=e}let r=this;for(offlineCustomTokens=offlineCustomTokens.map(e=>{let t=!0;if(e.a&&e.s){let n=e.a.toLowerCase();p.isWrappedETH(n)&&(t=!1);var a={name:p.escapeHtml(e.s),addr:n,unlisted:t,decimals:e.d};e.n&&(a.name2=p.escapeHtml(e.n)),e.lock&&(a.locked=!0),e.block&&(a.blocked=e.block),e.old&&(a.old=!0),e.warn&&(a.warning=!0),e.kill&&(a.killed=!0),e.inactive&&(a.inactive=!0),e.spam&&(a.spam=!0),e.blockIDEX&&(a.blockIDEX=!0),e.blockFork&&(a.blockFork=!0);for(let t=0;t<r.config.listedExchanges.length;t++){let n=r.config.listedExchanges[t];e[n]&&(a[n]=e[n],e.blockIDEX&&"IDEX"==n&&e.blockFork&&"ForkDelta"==n||(a.unlisted=!1))}return a}}),n=0;n<offlineCustomTokens.length;n++)(o=offlineCustomTokens[n])&&(o.Binance&&(this.binanceMap[o.Binance]=o.addr),this.uniqueTokens[o.addr]?o.unlisted||(this.uniqueTokens[o.addr].unlisted=!1):this.uniqueTokens[o.addr]=o);l("ForkDelta"),l("DDEX"),l("IDEX"),l("Radar"),l("Kyber"),l("OneInch");try{for(n=0;n<unknownTokenCache.length;n++){var o;(o=unknownTokenCache[n]).name&&""!==o.name&&(o.addr=o.addr.toLowerCase(),o.name=p.escapeHtml(o.name),o.decimals=Number(o.decimals),o.name2&&(o.name2=p.escapeHtml(o.name2)),o.unlisted=!0,this.uniqueTokens[o.addr]?o.name2&&o.name!==o.name2&&!this.uniqueTokens[o.addr].name2&&(this.uniqueTokens[o.addr].name2=o.name2):this.uniqueTokens[o.addr]=o)}}catch(e){console.log("failed to parse unknown token list")}{let e=Object.keys(this.config.uniswapContracts).map(e=>e.toLowerCase()),t=Object.values(this.config.uniswapContracts).map(e=>e.toLowerCase());for(let a=0;a<e.length;a++)if(!this.uniqueTokens[e[a]]){let n="UNI-V1";this.uniqueTokens[t[a]]&&(n+=" ("+this.uniqueTokens[t[a]].name+")");let r={addr:e[a],name:n,decimals:18,unlisted:!0,blocked:1};this.uniqueTokens[r.addr]=r}}if(offlineCollectibleTokens)try{let e=offlineCollectibleTokens.map(e=>{let t={addr:e.a.toLowerCase(),name:p.escapeHtml(e.s),decimals:0,unlisted:!0,erc721:!0};return e.n&&(t.name2=p.escapeHtml(e.n)),t});for(let t=0;t<e.length;t++){let a=e[t];this.uniqueTokens[a.addr]=a}}catch(e){console.log("error loading erc721 tokens: "+e)}let s=this.config.ethAddr;this.config.customTokens=Object.values(r.uniqueTokens).filter(e=>!(e.unlisted&&e.blocked||e.killed||e.erc721));let i=Object.values(r.uniqueTokens).filter(e=>!e.unlisted&&!e.killed&&e.addr!==s&&!e.erc721);function l(e){if(exchangeTokens&&e)try{let t=e.toLowerCase(),a=exchangeTokens[t];if(a&&a.length>0)for(let n=0;n<a.length;n++){let o=a[n];if(o){"etherdelta"!=t&&"forkdelta"!=t||(o.symbol=o.name,o.address=o.addr,delete o.name,o.fullName&&""!==o.fullName&&(o.name=o.fullName));let a={};a.addr=p.escapeHtml(o.address.toLowerCase()),a.name=p.escapeHtml(o.symbol),o.name&&(a.name2=p.escapeHtml(o.name)),a.decimals=Number(o.decimals),a[e]=a.name.toUpperCase(),r.uniqueTokens[a.addr]?(r.uniqueTokens[a.addr][e]=a.name,r.uniqueTokens[a.addr].blockIDEX&&"IDEX"==e||r.uniqueTokens[a.addr].blockFork&&"ForkDelta"==e||(r.uniqueTokens[a.addr].unlisted=!1),a.name2&&a.name!==a.name2&&!r.uniqueTokens[a.addr].name2&&(r.uniqueTokens[a.addr].name2=a.name2)):"TokenStore"!==e&&("IDEX"==e&&o.blockIDEX?a.unlisted=!0:a.unlisted=!1,r.uniqueTokens[a.addr]=a)}}}catch(t){console.log("failed to parse "+e+" token list")}}this.config.tokens=[this.uniqueTokens[s]].concat(i),this.config.balanceTokens=Object.values(r.uniqueTokens).filter(e=>!e.killed&&!e.erc721&&(!e.blocked||e.blocked<2))},g.prototype.setToken=function(e){if("0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee"===(e=e.toLowerCase())&&(e=this.config.ethAddr),this.uniqueTokens[e])return this.uniqueTokens[e];if(-1==e.indexOf("-"))return{addr:e,name:"???",unknown:!0,decimals:18,unlisted:!0};{let t=e.split("-");e=t[0];let a=t[1],n=e+"-"+a;if(this.uniqueTokens[n])return this.uniqueTokens[n];{let t=void 0;return this.uniqueTokens[e]?(t=this.uniqueTokens[e]).unknown=!1:t={unknown:!0,unlisted:!0,name:"???"},{addr:e,name:t.name,name2:t.name2?t.name2:void 0,unknown:t.unknown,decimals:0,unlisted:t.unlisted,erc721:!0,erc721Id:a}}}},g.prototype.processUnpackedInput=function(e,t){if(e.data&&!e.input&&(e.input=e.data),e&&e.input&&(!e.input||"depracated"!==e.input))if(e.contractAddress)console.log("unexpected tx input from transfer logs.");else{var a=this;try{var n=e.from.toLowerCase(),r=e.to.toLowerCase();if(!t||!t.name)return;if("transfer"===t.name||"transferFrom"===t.name||"safeTransferFrom"===t.name){let a=void 0,r=void 0,o=void 0,s=p.toBigNumber(0),i=this.setToken(e.to);return"transfer"===t.name?(a=t.params[0].value.toLowerCase(),o=t.params[1].value,r=n):(a=t.params[1].value.toLowerCase(),o=t.params[2].value,r=t.params[0].value.toLowerCase()),i&&i.addr&&("transferFrom"===t.name&&!i.unknown&&!i.erc721||"transfer"===t.name&&!i.erc721?s=p.weiToToken(o,i):(s=p.toBigNumber(1),i=this.setToken(i.addr+"-"+o))),{type:"Transfer",note:"Give the token contract the order to transfer your tokens",token:i,amount:s,from:r,to:a,unlisted:i.unlisted}}if("approve"===t.name){var o=t.params[0].value,s=t.params[1].value,i=p.toBigNumber(0);(v=this.setToken(e.to))&&v.addr&&(v.erc721?(i=p.toBigNumber(1),v=this.setToken(v.addr+"-"+s)):i=p.weiToToken(s,v));let a=this.getExchangeName(o,"unknown ");return{type:"Approve",exchange:a,note:"Approve "+a+"to move tokens for you.",token:v,amount:i,from:n,to:o,unlisted:v.unlisted}}if("setApprovalForAll"===t.name){o=t.params[0].value;var l=t.params[1].value;(v=this.setToken(e.to)).erc721||(v.erc721=!0,v.decimals=0,this.uniqueTokens[v.addr]=v);let a=this.getExchangeName(o,"unknown ");return{type:"Approve",exchange:a,note:"Approve "+a+"to move any tokenIDs for you.",token:v,amount:l?"All":0,from:n,to:o,unlisted:v.unlisted}}if("deposit"===t.name||"withdraw"===t.name&&"token"!==t.params[0].name&&t.params.length<9||"withdrawEther"===t.name||"depositEther"===t.name){var u="",d="",m=p.toBigNumber(0),v=void 0,g=void 0,k="";if("deposit"===t.name||"depositEther"===t.name)if(p.isWrappedETH(e.to))m=p.toBigNumber(e.value),u="Wrap ETH",d="Wrap ETH to WETH",v=this.setToken(this.config.ethAddr),g=this.setToken(e.to);else if(2==t.params.length&&"_forTime"==t.params[1].name){m=p.toBigNumber(t.params[0].value);let a=(g=this.setToken(e.to)).name;u="Wrap "+(a=a.indexOf("-W")>0?a.slice(0,a.length-2):a.slice(0,a.length-1)),d="Wrap a token to  lockable token for Ethfinex"}else u="Deposit",v=this.setToken(this.config.ethAddr),m=p.toBigNumber(e.value),d="unknown"===(k=this.getExchangeName(r,"unknown"))?"Deposit ETH into "+k:"Deposit ETH into the exchange contract";else if(m=t.params[0].value,p.isWrappedETH(e.to))u="Unwrap ETH",d="Unwrap WETH to ETH",v=this.setToken(e.to),g=this.setToken(this.config.ethAddr);else if(5==t.params.length&&"signatureValidUntilBlock"==t.params[4].name){m=p.toBigNumber(t.params[0].value);let e=(v=this.setToken(r)).name;u="Unwrap "+(e=e.indexOf("-W")>0?e.slice(0,e.length-2):e.slice(0,e.length-1)),d="Unwrap a lockable Ethfinex token"}else u="Withdraw",v=this.setToken(this.config.ethAddr),d="unknown"===(k=this.getExchangeName(r,"unknown"))?"Request "+k+" to withdraw ETH":"Request the exchange contract to withdraw ETH";return i=void 0,v?i=p.weiToToken(m,v):g&&(i=p.weiToToken(m,g)),-1===u.indexOf("rap")?{type:u,exchange:k,token:v,note:d,amount:i}:{type:u,"token In":v,"token Out":g,note:d,amount:i}}if("depositToken"===t.name||"withdrawToken"===t.name||"directWithdrawal"===t.name||"depositWrappedEther"===t.name||"withdrawBoth"===t.name||"depositBoth"===t.name||"withdraw"===t.name&&2==t.params.length&&"token"===t.params[0].name||"multiSigWithdrawal"==t.name){let a=void 0,n=1;if("depositWrappedEther"===t.name?(a=this.setToken("0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2"),n=0):a=this.setToken(t.params[0].value),a&&a.addr){i=p.weiToToken(t.params[n].value,a),u="",d="";let o=this.getExchangeName(r,"");"withdrawToken"===t.name||"withdrawBoth"===t.name||"withdraw"===t.name||"directWithdrawal"===t.name||"multiSigWithdrawal"==t.name?(u="Withdraw",d=o?"Request "+o+" contract to withdraw "+a.name:"Request the exchange to withdraw "+a.name):(u="Deposit",d=o?"Request the "+o+" contract to deposit "+a.name:"Request the exchange contract to deposit "+a.name),a.addr!==this.config.ethAddr&&(u="Token "+u);var f={type:u,exchange:o,note:d,token:a,amount:i,unlisted:a.unlisted};if("withdrawBoth"===t.name||"depositBoth"===t.name){f.type="Token & ETH "+u,f.base=this.setToken(this.config.ethAddr);let a=p.toBigNumber(0);a="withdrawBoth"===t.name?p.toBigNumber(t.params[2].value):p.toBigNumber(e.value);let n=p.weiToEth(a);f.baseAmount=n}return f}}else{if("userSigWithdrawal"==t.name){let e=t.params[0].value.slice(0,34);return p.hexToDec(e),t.params[1].value.slice(0,6),{type:"Withdraw",exchange:this.getExchangeName(r,""),note:"Tokens withdrawn by admin",token:"",amount:"",unlisted:!0}}if("withdraw"===t.name&&9==t.params.length||"emergencyWithdraw"==t.name){v=this.setToken(t.params[1].value);var T="";if("withdraw"===t.name&&(T=this.setToken(t.params[3].value)),v&&v.addr){s=p.toBigNumber(t.params[2].value),i=p.weiToToken(s,v),u="",d="";var b=p.toBigNumber(0);let e=this.getExchangeName(r,"");if(T&&T.addr){var w=p.toBigNumber(t.params[4].value);b=p.weiToToken(w,T)}return v.addr!==this.config.ethAddr?(u="Token Withdraw",d=p.addressLink(t.params[2].value,!0,!0)+" requested Switcheo to withdraw tokens"):(u="Withdraw",d=p.addressLink(t.params[2].value,!0,!0)+" requested Switcheo to withdraw ETH"),{type:u,exchange:e,note:d,token:v,amount:i,to:t.params[0].value.toLowerCase(),unlisted:v.unlisted,fee:b,feeToken:T}}}else if("depositERC20"==t.name){if((v=this.setToken(t.params[1].value))&&v.addr){i=p.weiToToken(t.params[2].value,v),u="Deposit";let e=this.getExchangeName(r,"");return d="",{type:"Token "+u,exchange:e,note:d=e?"Request the "+e+" contract to deposit "+v.name:"Request the exchange contract to deposit "+v.name,token:v,amount:i,unlisted:v.unlisted}}}else if("cancelOrder"===t.name&&t.params.length>3){var B="sell";v=void 0,g=void 0;let e=this.setToken(t.params[0].value),a=this.setToken(t.params[2].value),n=this.getExchangeName(r,"");if(this.isBaseToken(e,a)?(B="buy",v=a,g=e):(v=e,g=a),v&&g&&v.addr&&g.addr){s=p.toBigNumber(0);var y=p.toBigNumber(0);"sell"===B?(s=p.toBigNumber(t.params[1].value),y=p.toBigNumber(t.params[3].value)):(y=p.toBigNumber(t.params[1].value),s=p.toBigNumber(t.params[3].value)),i=p.weiToToken(s,v);var N=p.weiToToken(y,g),x=p.toBigNumber(0);return i.greaterThan(0)&&(x=N.div(i)),{type:"Cancel "+B,exchange:n,note:"Cancel an open order",token:v,amount:i,price:x,base:g,baseAmount:N,unlisted:v.unlisted}}}else{if("cancelOrder"===t.name&&1==t.params.length&&"order"==t.params[0].name&&8==t.params[0].value.length){let e=t.params[0].value[0].value.toLowerCase(),n=t.params[0].value[1].value.toLowerCase(),r=a.setToken(t.params[0].value[3].value),o=a.setToken(t.params[0].value[2].value),s=p.toBigNumber(t.params[0].value[5].value),i=p.toBigNumber(t.params[0].value[4].value),l=t.params[0].value[1].value.toLowerCase().slice(4,6);l="00"==l?"buy":"sell";let u=this.getExchangeName(n,"Unknown DDEX"),d=p.weiToToken(i,o),m=p.weiToToken(s,r),c=p.toBigNumber(0);return d.greaterThan(0)&&(c=m.div(d)),{type:"Cancel "+l,exchange:u,note:"Cancel an open order",token:o,amount:d,price:c,base:r,baseAmount:m,unlisted:o.unlisted,maker:e}}if("cancelOrder"===t.name||"batchCancelOrders"===t.name){if("order"==t.params[0].name||"orders"==t.params[0].name)if("cancelOrder"==t.name){let e=F(t.params[0].value);if(!e)return;t.params[0].value=e.orderAddresses,t.params.push({type:"uint256[]",value:e.orderValues}),t.params.push({type:"uint256",value:e.orderValues[1]})}else if("batchCancelOrders"==t.name){let e=t.params[0].value,a=[],n=[],r=e[0][10],o=e[0][11];for(let t=0;t<e.length;t++){t>0&&("0x"==e[t][10]&&(e[t][10]=r),"0x"==e[t][11]&&(e[t][11]=o));let s=F(e[t]);s&&(a.push(s.orderAddresses),n.push(s.orderValues))}if(0==a.length)return;let s=n.map(e=>e[1]);t.params[0].value=a,t.params.push({type:"uint256[][]",value:n}),t.params.push({type:"uint256[]",value:s})}if(k="","cancelOrder"===t.name)return C(t.params[0].value,t.params[1].value,p.toBigNumber(t.params[2].value));if("batchCancelOrders"===t.name){let e=t.params[0].value,a=t.params[1].value,n=t.params[2].value.map(e=>p.toBigNumber(e));var A=[];for(let t=0;t<e.length;t++)(f=C(e[t],a[t],n[t]))&&A.push(f);return A}function C(e,t,n){let r=e[0].toLowerCase(),o=e[1].toLowerCase(),s=a.setToken(e[2]),i=a.setToken(e[3]),l=p.toBigNumber(t[0]),u=p.toBigNumber(t[1]),d=e[4].toLowerCase();if(d===a.config.ethAddr&&(d=o,e.length>=6)){let t=e[5].toLowerCase();t!==r&&t!==a.config.ethAddr&&(d=t)}k=p.relayName(d);var m="Sell",c=void 0,h=void 0;if(a.isBaseToken(i,s)?(m="Buy",c=s,h=i):(c=i,h=s),c&&h&&c.addr&&h.addr){var v=p.toBigNumber(0),g=p.toBigNumber(0),f=n;"Sell"===m?(v=u,g=l):(g=u,v=l);var T=p.weiToToken(v,c),b=p.weiToToken(g,h),w=p.toBigNumber(0),B=p.toBigNumber(0);return T.greaterThan(0)&&(B=b.div(T)),"Buy"===m?(w=T,g.greaterThan(f)&&(b=p.weiToToken(f,h),v=f.div(g.div(v)),T=p.weiToToken(v,c))):(w=T,v.greaterThan(f)&&(T=p.weiToToken(f,c),g=f.times(g).div(v),b=p.weiToToken(g,h))),c.erc721&&(b=(T=p.toBigNumber(1)).times(B)),h.erc721&&(b=p.toBigNumber(1)),c.erc721&&h.erc721&&(B=p.toBigNumber(1)),{type:"Cancel "+m.toLowerCase(),exchange:k,note:p.addressLink(r,!0,!0)+"Cancels an open order in the orderbook.",token:c,amount:T,price:B,base:h,baseAmount:b,"order size":w,unlisted:c.unlisted,relayer:d}}}}else{if("executeTransaction"==t.name){let a=void 0,r=void 0;"transaction"==t.params[0].name?(a=t.params[0].value[3].value.toLowerCase(),r=t.params[0].value[4].value):(a=t.params[1].value.toLowerCase(),r=t.params[2].value);let o=[{type:"Signed execution",exchange:p.relayName(n,"0x Exchange"),note:"a 0x trade/cancel executed through a third party for a signer address",sender:e.from,signer:a}];try{const t=r;let n=p.processInput(t);if(n){let t=e;t.to!==a&&(t.from=a);let r=this.processUnpackedInput(t,n);r?Array.isArray(r)?o=o.concat(r):o.push(r):console.log("unable to process subcall")}else console.log("unable to parse executeTransaction subcall")}catch(e){}return o.length>1&&o[0].exchange!==o[1].exchange&&(o[0].exchange=o[1].exchange),o}if("cancelOrdersUpTo"===t.name)return{type:"Cancel up to",exchange:this.getExchangeName(r,"0x Exchange"),note:"Cancels all open 0x orders up to a certain date",tokens:"All",maker:e.from,orderEpoch:t.params[0].value};if(("cancel"===t.name||"fill"===t.name)&&t.params.length>10){let e=t.params[0].value.toLowerCase(),a=t.params[3].value.toLowerCase(),n=this.setToken(t.params[2].value),o=this.setToken(t.params[5].value),l=p.toBigNumber(t.params[1].value),u=p.toBigNumber(t.params[4].value),d=this.getExchangeName(r,"");var L="Sell";if(v=void 0,g=void 0,this.isBaseToken(o,n)?(L="Buy",v=n,g=o):(v=o,g=n),v&&g&&v.addr&&g.addr)return s=p.toBigNumber(0),y=p.toBigNumber(0),"Sell"===L?(s=u,y=l):(y=u,s=l),i=p.weiToToken(s,v),N=p.weiToToken(y,g),x=p.toBigNumber(0),i.greaterThan(0)&&(x=N.div(i)),"cancel"===t.name?{type:"Cancel "+L.toLowerCase(),exchange:d,note:p.addressLink(e,!0,!0)+"Cancels an open order.",token:v,amount:i,price:x,base:g,baseAmount:N,"order size":N,unlisted:v.unlisted}:{type:"Taker "+L,exchange:d,note:p.addressLink(a,!0,!0)+" selected "+p.addressLink(e,!0,!0)+"'s order.",token:v,amount:i,price:x,base:g,baseAmount:N,"order size":N,unlisted:v.unlisted,taker:a,maker:e}}else{if(("cancel"===t.name||"kill"==t.name)&&1==t.params.length)return{type:"Cancel offer",exchange:this.getExchangeName(r,""),orderID:p.toBigNumber(t.params[0].value),note:"Cancel an open order"};if("trade"===t.name&&(11==t.params.length||12==t.params.length||4==t.params.length)||"tradeEtherDelta"===t.name||"instantTrade"===t.name||"order"===t.name){let e=!1;if(4==t.params.length){e=!0;let a=[];a[0]={value:t.params[1].value[0]},a[1]={value:t.params[0].value[0]},a[2]={value:t.params[1].value[1]},a[3]={value:t.params[0].value[1]},a[4]={value:t.params[0].value[2]},a[5]={value:t.params[0].value[5]},a[6]={value:t.params[1].value[2]},a[7]={value:t.params[2].value[0]},a[8]={value:t.params[3].value[0]},a[9]={value:t.params[3].value[1]},a[10]={value:t.params[0].value[4]},a[11]={value:t.params[1].value[3]},t.params=a}L="Sell",v=void 0,g=void 0;let a=this.setToken(t.params[0].value),o=this.setToken(t.params[2].value),l=this.getExchangeName(r,"");if(this.isBaseToken(a,o)?(L="Buy",v=o,g=a):(v=a,g=o),v&&g&&v.addr&&g.addr){s=p.toBigNumber(0),y=p.toBigNumber(0),"Sell"===L?(s=p.toBigNumber(t.params[1].value),y=p.toBigNumber(t.params[3].value)):(y=p.toBigNumber(t.params[1].value),s=p.toBigNumber(t.params[3].value)),i=p.weiToToken(s,v),N=p.weiToToken(y,g);var E=p.toBigNumber(0);if(x=p.toBigNumber(0),i.greaterThan(0)&&(x=N.div(i)),E=i,t.params.length>=11){var O=p.toBigNumber(t.params[10].value);"Buy"===L?y.greaterThan(O)&&(N=p.weiToToken(O,g),s=O.div(y.div(s)),i=p.weiToToken(s,v)):s.greaterThan(O)&&(i=p.weiToToken(O,v),y=O.times(y).div(s),N=p.weiToToken(y,g))}let a=e?t.params[11].value:n,r="order"!==t.name?t.params[6].value.toLowerCase():n,o=p.toBigNumber(0),u=p.toBigNumber(0),d="",m="";if(e){const e=p.toBigNumber(1e18);let t=p.toBigNumber(2e15),a=p.toBigNumber(1e15);"Sell"===L?(t.greaterThan(0)&&(o=p.weiToToken(s.times(t).div(e),v),d=v),a.greaterThan(0)&&(u=p.weiToToken(y.times(a).div(e),g),m=g)):"Buy"===L&&(t.greaterThan(0)&&(o=p.weiToToken(y.times(t).div(e),g),d=g),a.greaterThan(0)&&(u=p.weiToToken(s.times(a).div(e),v),m=g))}return"order"!==t.name?(f={type:"Taker "+L,exchange:l,note:p.addressLink(a,!0,!0)+" selected "+p.addressLink(r,!0,!0)+"'s order in the orderbook to trade.",token:v,amount:i,price:x,base:g,baseAmount:N,"order size":E,unlisted:v.unlisted,taker:a,maker:r},e&&(f.takerFee=o,f.FeeToken=d,f.makerFee=u,f["FeeToken "]=m),f):{type:L+" offer",exchange:l,note:p.addressLink(r,!0,!0)+" placed an on-chain order.",token:v,amount:i,price:x,base:g,baseAmount:N,unlisted:v.unlisted,maker:r}}}else{if("trade"===t.name&&3==t.params.length){let e=t.params[1].value.length-1;A=[];for(let a=0;a<e;a++){let e=10*a;(f=D(Number(t.params[0].value[0+e])>0,p.toBigNumber(t.params[0].value[6+e]),p.toBigNumber(t.params[0].value[5+e]),t.params[1].value[0].toLowerCase(),t.params[1].value[a+1]))&&A.push(f)}return A&&A.length>0?A:void 0;function D(e,t,o,s,i){var l="Sell";e&&(l="Buy");var u=a.setToken(s),d=a.setToken(a.config.ethAddr);let m=this.getExchangeName(r,"");if(u&&d&&u.addr&&d.addr){var c=p.weiToToken(t,u);o=p.weiToToken(o,d);let e=a.divisorFromDecimals(d.decimals-u.decimals);o=p.weiToEth(o,e);var h=c.times(o);let r=n,s=i.toLowerCase();return{type:"Taker "+l,exchange:m,note:p.addressLink(r,!0,!0)+" selected "+p.addressLink(s,!0,!0)+"'s order in the orderbook to trade.",token:u,amount:c,price:o,base:d,baseAmount:h,unlisted:u.unlisted,taker:r,maker:s}}}}if("trade"===t.name&&7==t.params.length||"tradeWithHint"==t.name){let e=0;"trader"==t.params[0].name&&(e=1);let a=n,o=this.setToken(t.params[0+e].value),l=this.setToken(t.params[2+e].value),u=p.toBigNumber(t.params[1+e].value),d=p.toBigNumber(t.params[4+e].value),m=p.toBigNumber(t.params[5+e].value),c=p.toBigNumber(0),h=p.toBigNumber(0);L="Sell",v=void 0,g=void 0;let k=this.getExchangeName(r,"");if(this.isBaseToken(o,l)?(L="Buy",v=l,g=o):(v=o,g=l),v&&g&&v.addr&&g.addr)return s=p.toBigNumber(0),y=p.toBigNumber(0),"Sell"===L?(s=u,y=d):(y=u,s=d),i=p.weiToToken(s,v),N=p.weiToToken(y,g),"Sell"===L?(N=m.times(i),N=p.weiToToken(N,g),c=p.weiToToken(m,g),{type:L+" up to",exchange:k,note:p.addressLink(a,!0,!0)+"made a trade.",token:v,amount:i,minPrice:c,base:g,estBaseAmount:N,unlisted:v.unlisted,taker:a}):(h=p.toBigNumber(1e18).div(m),i=N.div(h),{type:L+" up to",exchange:k,note:p.addressLink(a,!0,!0)+"made a trade.",token:v,estAmount:i,maxPrice:h,base:g,baseAmount:N,unlisted:v.unlisted,taker:a})}else{if("swapTokenToToken"===t.name||"swapTokenToEther"===t.name||"swapEtherToToken"==t.name){let a=void 0,o=void 0,s=void 0,i=void 0;"swapTokenToEther"==t.name?(o=this.setToken(t.params[0].value),s=this.setToken(this.config.ethAddr),i=p.toBigNumber(t.params[1].value),a=p.toBigNumber(t.params[2].value)):"swapEtherToToken"==t.name?(o=this.setToken(this.config.ethAddr),s=this.setToken(t.params[0].value),i=p.toBigNumber(e.value),a=p.toBigNumber(t.params[1].value)):(o=this.setToken(t.params[0].value),s=this.setToken(t.params[2].value),i=p.toBigNumber(t.params[1].value),a=p.toBigNumber(t.params[3].value));let l=n,u=p.toBigNumber(0),d=p.toBigNumber(0);L="Sell",v=void 0,g=void 0;let m=this.getExchangeName(r,""),c=p.toBigNumber(0),h=p.toBigNumber(0);return this.isBaseToken(o,s)?(L="Buy",v=s,g=o,h=p.weiToToken(i,g),inverseMax=p.weiToToken(a,g),d=p.toBigNumber(1).div(inverseMax),c=h.div(d)):(v=o,g=s,c=p.weiToToken(i,v),u=g.decimals>v.decimals?p.weiToToken(a,g):p.weiToToken(a,v),h=c.times(u)),"Sell"===L?{type:L+" up to",exchange:m,note:p.addressLink(l,!0,!0)+"made a trade.",token:v,amount:c,minPrice:u,base:g,estBaseAmount:h,unlisted:v.unlisted,taker:l}:{type:L+" up to",exchange:m,note:p.addressLink(l,!0,!0)+"made a trade.",token:v,estAmount:c,maxPrice:d,base:g,baseAmount:h,unlisted:v.unlisted,taker:l}}if("matchOrders"==t.name&&t.params.length>0&&"takerOrderParam"===t.params[0].name){let e=3==t.params.length,n=void 0,r=Array(t.params[1].length).fill(void 0);e?n=t.params[2].value:(n=t.params[3].value,r=t.params[2].value);let o=S(t.params[0].value,void 0);o.type=o.type.replace("Maker ",""),o.type+=" up to";let s=t.params[1].value.map((e,t)=>S(e,r[t]));return[o].concat(s);function S(e,t){let r=e[0].value.toLowerCase(),o=a.setToken(n[1].value),s=a.setToken(n[0].value),i=n[2].value.toLowerCase(),l=p.toBigNumber(e[2].value),u=p.toBigNumber(e[1].value),d=e[4].value.toLowerCase().slice(4,6);d="00"==d?"Buy":"Sell";let m=p.relayName(i,"DDEX"),c=p.weiToToken(u,s),h=p.weiToToken(l,o),v=p.toBigNumber(0);return c.greaterThan(0)&&(v=h.div(c)),t&&(h=(c=p.weiToToken(t,s)).times(v)),{type:"Maker "+d,exchange:m,note:"Matching buy and sell orders in the orderbook",token:s,amount:c,price:v,base:o,baseAmount:h,unlisted:s.unlisted,relayer:i,maker:r}}}if("fillOrder"===t.name||"fillOrKillOrder"===t.name||"fillOrdersUpTo"===t.name||"fillOrderNoThrow"===t.name||"batchFillOrders"===t.name||"batchFillOrKillOrders"===t.name||"batchFillOrdersNoThrow"===t.name||"marketSellOrders"===t.name||"marketSellOrdersNoThrow"===t.name||"marketSellOrdersFillOrKill"==t.name||"marketBuyOrders"===t.name||"marketBuyOrdersNoThrow"===t.name||"marketBuyOrdersFillOrKill"==t.name||"matchOrders"===t.name||"marketBuyOrdersWithEth"==t.name||"marketSellOrdersWithEth"==t.name){let r=t.params.find(e=>e.type&&-1!==e.type.indexOf("tuple")),o="";if(r)if("fillOrder"==t.name||"fillOrKillOrder"==t.name||"fillOrderNoThrow"==t.name){let e=F(t.params[0].value);if(!e)return;let a=t.params[1].value;o=t.name,t.name="fillOrder",t.params[0].value=e.orderAddresses,t.params[1].value=e.orderValues,t.params[2].value=a}else if("matchOrders"==t.name){let e=F(t.params[0].value);"0x"!=t.params[1].value[10].value&&"0x"!=t.params[1].value[11]||(t.params[1].value[10]=t.params[0].value[11],t.params[1].value[11]=t.params[0].value[10]);let a=F(t.params[1].value);if(!e&&a)return;let n=t.params[0].value[5].value,r=t.params[1].value[5].value;t.params[0].value=[e.orderAddresses,a.orderAddresses],t.params[1].value=[e.orderValues,a.orderValues],t.params[2].value=[n,r]}else if("batchFillOrders"==t.name||"batchFillOrKillOrders"==t.name||"batchFillOrdersNoThrow"==t.name){let e=t.params[0].value,a=[],n=[],r=[],s=e[0][10].value,i=e[0][11].value;for(let o=0;o<e.length;o++){o>0&&("0x"==e[o][10].value&&(e[o][10].value=s),"0x"==e[o][11].value&&(e[o][11].value=i));let l=F(e[o]);if(l){let e=t.params[1].value[o];a.push(l.orderAddresses),n.push(l.orderValues),r.push(e)}}if(0==a.length)return;o=t.name,t.name="batchFillOrders",t.params[0].value=a,t.params[1].value=n,t.params[2].value=r}else if("marketSellOrders"==t.name||"marketSellOrdersNoThrow"==t.name||"marketSellOrdersFillOrKill"==t.name||"marketBuyOrders"==t.name||"marketBuyOrdersNoThrow"==t.name||"marketBuyOrdersFillOrKill"==t.name||"marketBuyOrdersWithEth"==t.name||"marketSellOrdersWithEth"==t.name){let a=t.params[0].value,n=[],r=[],s=void 0;s="marketSellOrdersWithEth"==t.name?e.value:t.params[1].value;let i=a[0][10].value,l=a[0][11].value;if(-1!==t.name.indexOf("WithEth")){let e="0xf47261b0000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2";"0x"==l?l=e:"0x"==i&&(i=e)}for(let e=0;e<a.length;e++){(e>0||-1!==t.name.indexOf("WithEth"))&&("0x"==a[e][10].value&&(a[e][10].value=i),"0x"==a[e][11].value&&(a[e][11].value=l));let o=F(a[e]);o&&(n.push(o.orderAddresses),r.push(o.orderValues))}if(0==n.length)return;o=t.name,t.name="fillOrdersUpTo",t.params[0].value=n,t.params[1].value=r,t.params[2].value=s}if(k="","fillOrder"===t.name||"fillOrKillOrder"==t.name){let e=t.params[0].value,a=t.params[1].value,n=p.toBigNumber(t.params[2].value);return o&&(t.name=o),I(e,a,n)}if("batchFillOrders"===t.name||"batchFillOrKillOrders"==t.name){let e=t.params[0].value,a=t.params[1].value,n=t.params[2].value.map(e=>p.toBigNumber(e));A=[];for(let t=0;t<e.length;t++)(f=I(e[t],a[t],n[t]))&&A.push(f);return o&&(t.name=o),A}if("matchOrders"===t.name){let e=t.params[0].value,a=t.params[1].value,n=t.params[2].value.map(e=>p.toBigNumber(e));A=[];for(let t=0;t<e.length;t++)(f=I(e[t],a[t],n[t]))&&A.push(f);return A[0].baseAmount=A[1].baseAmount,A[0].amount=A[0].baseAmount.div(A[0].price),o&&(t.name=o),A}if("fillOrdersUpTo"===t.name){let a=t.params[0].value,r=t.params[1].value,s=p.toBigNumber(t.params[2].value),l=this.setToken(a[0][3]),u=!1;o&&o.indexOf("arketBuy")>=0&&(u=!0);let d=[];for(let e=0;e<a.length;e++){let t=I(a[e],r[e],s,u);t&&d.push(t)}if(0==d.length)return;let m=d[0].price,c=m;for(let e=1;e<d.length;e++){let t=d[e].price;t.greaterThan(c)?c=t:m.greaterThan(t)&&(m=t)}let h=l.addr==d[0].token.addr;u&&(h=!h,l=this.setToken(a[0][2]));let v=p.weiToToken(s,l);d[0].token.erc721&&(i=p.toBigNumber(1)),d[0].base.erc721&&(N=p.toBigNumber(1)),d[0].token.erc721&&d[0].base.erc721&&(m=p.toBigNumber(1),c=p.toBigNumber(1));let g=d[0].relayer;k=d[0].exchange;let f=n,T={type:d[0].type.slice(6)+" up to",exchange:k,note:p.addressLink(f,!0,!0)+"selects 1 or more orders to fill an amount",token:d[0].token,amount:v,minPrice:m,maxPrice:c,unlisted:d[0].unlisted,base:d[0].base,baseAmount:v,estBaseAmount:void 0,relayer:g,taker:f};return o&&(t.name=o),-1!==o.indexOf("WithEth")?(T.exchange="0x Instant ","marketBuyOrdersWithEth"===o&&h&&p.isWrappedETH(T.base.addr)?T.estBaseAmount=p.weiToEth(e.value):delete T.estBaseAmount):delete T.estBaseAmount,h?delete T.baseAmount:delete T.amount,d=d.map(e=>(e.type.indexOf("Buy")>=0?e.type=e.type.replace("Buy","Sell"):e.type=e.type.replace("Sell","Buy"),e.type=e.type.replace("Taker ",""),e.type=e.type.replace("Maker",""),e.type+=" Order",e)),[T].concat(d)}function I(e,t,r,o=!1){let s=e[0].toLowerCase(),i=n,l=e[1].toLowerCase(),u=a.setToken(e[2]),d=a.setToken(e[3]),m=p.toBigNumber(t[0]),c=p.toBigNumber(t[1]),h=e[4].toLowerCase();if(h===a.config.ethAddr&&(h=l,e.length>=6)){let t=e[5].toLowerCase();t!==s&&t!==a.config.ethAddr&&(h=t)}k=p.relayName(h);var v="Sell",g=void 0,f=void 0;if(a.isBaseToken(d,u)?(v="Buy",g=u,f=d):(g=d,f=u),g&&f&&g.addr&&f.addr){var T=p.toBigNumber(0),b=p.toBigNumber(0),w=r;"Sell"===v?(T=c,b=m):(b=c,T=m);var B=p.weiToToken(T,g),y=p.weiToToken(b,f),N=p.toBigNumber(0),x=p.toBigNumber(0);return B.greaterThan(0)&&(x=y.div(B)),"Buy"===v&&!o||"Sell"===v&&o?(N=B,b.greaterThan(w)&&(y=p.weiToToken(w,f),T=w.div(b.div(T)),B=p.weiToToken(T,g))):(N=B,T.greaterThan(w)&&(B=p.weiToToken(w,g),b=w.times(b).div(T),y=p.weiToToken(b,f))),g.erc721&&(y=(B=p.toBigNumber(1)).times(x)),f.erc721&&(y=p.toBigNumber(1)),g.erc721&&f.erc721&&(x=p.toBigNumber(1)),{type:"Taker "+v,exchange:k,note:p.addressLink(i,!0,!0)+" selected "+p.addressLink(s,!0,!0)+"'s order in the orderbook to trade.",token:g,amount:B,price:x,base:f,baseAmount:y,"order size":N,unlisted:g.unlisted,relayer:h,maker:s,taker:i}}}}else if("settleTrade"==t.name||"batchSettleTrades"==t.name||"settleReserveTrade"==t.name);else if("offer"==t.name||"make"==t.name){if("make"==t.name){let e=[t.params[2],t.params[0],t.params[3],t.params[1]];t.params=e}L="Sell",v=void 0,g=void 0;let e=this.setToken(t.params[1].value),a=this.setToken(t.params[3].value),o=this.getExchangeName(r,"");if(this.isBaseToken(e,a)?(L="Buy",v=a,g=e):(v=e,g=a),v&&g&&v.addr&&g.addr)return s=p.toBigNumber(0),y=p.toBigNumber(0),"Sell"===L?(s=p.toBigNumber(t.params[0].value),y=p.toBigNumber(t.params[2].value)):(y=p.toBigNumber(t.params[0].value),s=p.toBigNumber(t.params[2].value)),i=p.weiToToken(s,v),N=p.weiToToken(y,g),E=p.toBigNumber(0),x=p.toBigNumber(0),i.greaterThan(0)&&(x=N.div(i)),{type:L+" offer",exchange:o,note:p.addressLink(n,!0,!0)+" created a trade offer",token:v,amount:i,price:x,base:g,baseAmount:N,unlisted:v.unlisted,maker:n}}else{if(("buy"==t.name||"take"==t.name)&&2==t.params.length)return{type:"Fill offer",exchange:this.getExchangeName(r,""),orderID:p.toBigNumber(t.params[0].value),note:" Fill a trade order"};if("buyAllAmount"!=t.name&&"buyAllAmountPayEth"!=t.name&&"buyAllAmountBuyEth"!=t.name&&"createAndBuyAllAmount"!=t.name&&"createAndBuyAllAmountPayEth"!=t.name&&"createAndBuyAllAmountBuyEth"!=t.name||"otc"!=t.params[0].name&&"factory"!=t.params[0].name){if(!("sellAllAmount"!=t.name&&"sellAllAmountPayEth"!=t.name&&"sellAllAmountBuyEth"!=t.name&&"createAndSellAllAmount"!=t.name&&"createAndSellAllAmountPayEth"!=t.name&&"createAndSellAllAmountBuyEth"!=t.name||"otc"!=t.params[0].name&&"factory"!=t.params[0].name)){let a,n,o,s,l="0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2";"createAndSellAllAmount"==t.name?(t.name="sellAllAmount",t.params=t.params.slice(1)):"createAndSellAllAmountBuyEth"==t.name?(t.name="sellAllAmountBuyEth",t.params=[t.params[1],t.params[2],t.params[3],{value:l},t.params[4]]):"createAndSellAllAmountPayEth"==t.name&&(t.name="sellAllAmountPayEth",t.params=[t.params[1],{value:l},t.params[2],t.params[3]]),L="Buy",v=void 0,g=void 0,"sellAllAmount"==t.name||"sellAllAmountBuyEth"==t.name?(a=this.setToken(t.params[1].value),n=this.setToken(t.params[3].value),o=p.toBigNumber(t.params[2].value),s=p.toBigNumber(t.params[4].value)):"sellAllAmountPayEth"==t.name&&(a=this.setToken(t.params[1].value),n=this.setToken(t.params[2].value),o=p.toBigNumber(e.value),s=p.toBigNumber(t.params[3].value));let u,d,m=this.getExchangeName(r,"OasisDirect");if(this.isBaseToken(a,n)?(L="Buy",v=n,u=s,g=a,d=o):(L="Sell",v=a,u=o,g=n,d=s),v&&g&&v.addr&&g.addr)return i=p.weiToToken(u,v),N=p.weiToToken(d,g),E=p.toBigNumber(0),x=p.toBigNumber(0),i.greaterThan(0)&&(x=N.div(i)),"Sell"===L?{type:L+" up to",exchange:m,note:"Trade on OasisDex",token:v,amount:i,minPrice:x,base:g,estBaseAmount:N,unlisted:v.unlisted}:{type:L+" up to",exchange:m,note:"Trade on OasisDex",token:v,estAmount:i,maxPrice:x,base:g,baseAmount:N,unlisted:v.unlisted}}}else{let a="0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2";"createAndBuyAllAmount"==t.name?(t.name="buyAllAmount",t.params=t.params.slice(1)):"createAndBuyAllAmountBuyEth"==t.name?(t.name="buyAllAmountBuyEth",t.params=[t.params[1],{value:a},t.params[2],t.params[3],t.params[4]]):"createAndBuyAllAmountPayEth"==t.name&&(t.name="buyAllAmountPayEth",t.params=t.params.slice(1),t.params.push({value:a}));L="Buy",v=void 0,g=void 0;let n,o,s,l;"buyAllAmount"==t.name||"buyAllAmountBuyEth"==t.name?(n=this.setToken(t.params[3].value),o=this.setToken(t.params[1].value),s=p.toBigNumber(t.params[4].value),l=p.toBigNumber(t.params[2].value)):"buyAllAmountPayEth"==t.name&&(n=this.setToken(t.params[3].value),o=this.setToken(t.params[1].value),s=p.toBigNumber(e.value),l=p.toBigNumber(t.params[2].value));let u,d,m=this.getExchangeName(r,"OasisDirect");if(this.isBaseToken(n,o)?(L="Buy",v=o,u=l,g=n,d=s):(L="Sell",v=n,u=s,g=o,d=l),v&&g&&v.addr&&g.addr){i=p.weiToToken(u,v),N=p.weiToToken(d,g),E=p.toBigNumber(0),x=p.toBigNumber(0);return i.greaterThan(0)&&(x=N.div(i)),"Sell"===L?{type:L+" up to",exchange:m,note:"Trade on OasisDex",token:v,estAmount:i,minPrice:x,base:g,baseAmount:N,unlisted:v.unlisted}:{type:L+" up to",exchange:m,note:"Trade on OasisDex",token:v,amount:i,maxPrice:x,base:g,estBaseAmount:N,unlisted:v.unlisted}}}}}}}}}}if("execute"==t.name){let a=[{type:"Indirect execution",Exchange:"OasisDirect ",note:"Call OasisDirect through a proxy",sender:e.from}];try{const n=t.params[1].value;let r=p.processInput(n);if(r){let t=e,n=this.processUnpackedInput(t,r);n?Array.isArray(n)?a=a.concat(n):a.push(n):r.name.indexOf("pay")&&t.contractAddress||console.log("unable to process subcall")}else console.log("unable to parse execute subcall")}catch(e){}return a}if(!p.isWrappedETH(r)||"change"!=t.name&&"quickChange"!=t.name)if("quickConvert"===t.name||"quickConvert2"===t.name||"quickConvertPrioritized"===t.name||"quickConvertPrioritized2"===t.name||"convert"===t.name||"convert2"===t.name||"convertFor"==t.name||"convertFor2"==t.name||"convertForPrioritized"==t.name||"convertForPrioritized2"==t.name||"convertForPrioritized3"==t.name||"convertForPrioritized4"==t.name||"claimAndConvert"==t.name||"claimAndConvert2"==t.name||"claimAndConvertFor"==t.name||"claimAndConvertFor2"==t.name||"change"==t.name||"quickChange"==t.name||"xConvert"===t.name||"xConvert2"===t.name||"xConvertPrioritized"===t.name||"xConvertPrioritized2"===t.name||"xConvertPrioritized3"===t.name){if(("convert"===t.name||"change"==t.name)&&"_fromToken"==t.params[0].name){let e=[];e[0]={value:[t.params[0].value,t.params[1].value]},e[1]={value:t.params[2].value},e[2]={value:t.params[3].value},t.params=e}let e="Sell",a=void 0,n=void 0,r=t.params[0].value,o=this.setToken(r[r.length-1]),s=this.setToken(r[0]),i="Bancor";if(this.isBaseToken(s,o)?(e="Buy",a=o,n=s):(e="Sell",a=s,n=o),a&&n&&a.addr&&n.addr){let r=p.toBigNumber(0),l=p.toBigNumber(0);"Sell"===e?(r=p.toBigNumber(t.params[1].value),l=p.toBigNumber(t.params[2].value)):(l=p.toBigNumber(t.params[1].value),r=p.toBigNumber(t.params[2].value));let u=p.weiToToken(r,a),d=p.weiToToken(l,n),m=p.toBigNumber(0);u.greaterThan(0)&&(m=d.div(u));let c=void 0;if(c="Sell"===e?{type:e+" up to",exchange:i,note:"bancor token conversion",token:a,amount:u,minPrice:m,base:n,estBaseAmount:d,unlisted:a.unlisted}:{type:e+" up to",exchange:i,note:"bancor token conversion",token:a,estAmount:u,maxPrice:m,base:n,baseAmount:d,unlisted:a.unlisted},0===t.name.indexOf("x")){let e=h.utils.parseBytes32String(t.params[3].value).trim();return[{type:"Trade (cross-chain)",exchange:"BancorX",note:"A cross-chain trade to the "+e+" blockchain",token:s,amount:a===s?u:d,blockchain:e,chainDestination:h.utils.parseBytes32String(t.params[4].value).trim(),unlisted:o.unlisted},c]}return c}}else{if("completeXConversion"==t.name||"completeXConversion2"==t.name){let e="Sell",a=void 0,n=void 0,r=t.params[0].value,o=this.setToken(r[r.length-1]),s=this.setToken(r[0]),l="Bancor",u=p.toBigNumber(t.params[1].value);i=p.weiToToken(u,s),this.isBaseToken(s,o)?(e="Buy",a=o,n=s):(e="Sell",a=s,n=o);let d=void 0;return d="Sell"===e?{type:e+" up to",exchange:l,note:"bancor token conversion",token:a,price:"",base:n,estBaseAmount:i,unlisted:a.unlisted}:{type:e+" up to",exchange:l,note:"bancor token conversion",token:a,estAmount:i,price:"",base:n,unlisted:a.unlisted}}if("reportTx"===t.name){let e=t.params[2].value.toLowerCase(),a=t.params[3].value,n=this.setToken("0x1f573d6fb3f13d689ff844b4ce37794d79a7ff1c"),r=h.utils.parseBytes32String(t.params[0].value).trim();return{type:"Transfer (cross-chain)",exchange:"BancorX",note:"Cross-chain token transfer of BNT from "+r,token:n,amount:p.weiToToken(a,n),blockchain:r,to:e,unlisted:n.unlisted}}if("adminWithdraw"===t.name){if((v=this.setToken(t.params[0].value))&&v.addr){s=p.toBigNumber(t.params[1].value);var q=p.toBigNumber(t.params[7].value);i=p.weiToToken(s,v),u="",d="";const e=p.toBigNumber(1e18);return b=p.weiToToken(q.times(s).div(e),v),v.addr!==this.config.ethAddr?(u="Token Withdraw",d=p.addressLink(t.params[2].value,!0,!0)+" requested IDEX to withdraw tokens"):(u="Withdraw",d=p.addressLink(t.params[2].value,!0,!0)+" requested IDEX to withdraw ETH"),{type:u,exchange:this.getExchangeName(r,""),note:d,token:v,amount:i,to:t.params[2].value.toLowerCase(),unlisted:v.unlisted,fee:b,feeToken:v}}}else if("takeBuyOrder"==t.name||"takeSellOrder"==t.name){let a=t.params[t.params.length-1].value.toLowerCase(),o=n,s=this.setToken(this.config.ethAddr),i=this.setToken(t.params[0].value),l="";l="takeSellOrder"==t.name?"Buy":"Sell";let u=this.getExchangeName(r,"");if(i&&s){let n=p.weiToToken(t.params[1].value,i),r=p.weiToToken(t.params[2].value,s);return x=p.toBigNumber(0),n.greaterThan(0)&&(x=r.div(n)),E=n,"takeSellOrder"==t.name&&p.toBigNumber(t.params[2].value)!==p.toBigNumber(e.value)?n=(r=p.weiToToken(t.params[2].value,s)).div(x):"takeBuyOrder"==t.name&&t.params[1].value!==t.params[3].value&&(r=(n=p.weiToToken(t.params[3].value,i)).times(x)),{type:"Taker "+l,exchange:u,note:p.addressLink(o,!0,!0)+" selected "+p.addressLink(a,!0,!0)+"'s order in the orderbook to trade.",token:i,amount:n,price:x,base:s,baseAmount:r,"order size":E,unlisted:i.unlisted,maker:a,taker:o}}}else if("makeSellOrder"==t.name||"makeBuyOrder"==t.name||"cancelAllSellOrders"==t.name||"cancelAllBuyOrders"==t.name){let a=this.setToken(this.config.ethAddr),o=this.setToken(t.params[0].value),s="",i=void 0;-1!==t.name.indexOf("Sell")?(i=p.toBigNumber(t.params[2].value),s="Sell"):(i="cancel"==t.name.slice(0,6)?p.toBigNumber(t.params[2].value):p.toBigNumber(e.value),s="Buy");let l=this.getExchangeName(r,"");if(a&&o){let e=p.weiToToken(t.params[1].value,o),r=p.weiToEth(i);return x=p.toBigNumber(0),e.greaterThan(0)&&(x=r.div(e)),"cancel"!==t.name.slice(0,6)?{type:s+" offer",exchange:l,note:p.addressLink(n,!0,!0)+" created a trade offer",token:o,amount:e,price:x,base:a,baseAmount:r,unlisted:o.unlisted,maker:n}:{type:"Cancel "+s,exchange:l,note:p.addressLink(n,!0,!0)+" cancelled a trade offer",token:o,amount:e,price:x,base:a,baseAmount:r,unlisted:o.unlisted,maker:n}}}else if("createBuyOrder"==t.name||"createSellOrder"==t.name||"sell"==t.name||"buy"==t.name){let a=this.setToken(this.config.ethAddr),o=this.setToken(t.params[0].value),s="",i=void 0;"sell"==t.name||"createSellOrder"==t.name?(i=p.toBigNumber(t.params[2].value),s="Sell"):(i=p.toBigNumber(e.value),s="Buy");let l=this.getExchangeName(r,"");if(a&&o){let e=p.weiToToken(t.params[1].value,o),r=p.weiToEth(i);return{type:s+" up to",exchange:l,note:p.addressLink(n,!0,!0)+" iniated a trade through an exchange aggregator.",token:o,amount:e,price:"",base:a,baseAmount:r,unlisted:o.unlisted,taker:n}}}else if(-1===t.name.indexOf("ethToToken")&&-1===t.name.indexOf("tokenToEth")&&-1===t.name.indexOf("tokenToToken")&&-1===t.name.indexOf("tokenToExchange")||-1===t.name.indexOf("Transfer")&&-1===t.name.indexOf("Swap"))if("addLiquidity"==t.name){let n=this.uniqueTokens[r],o=this.uniqueTokens[this.config.uniswapContracts[r]],s=this.uniqueTokens[a.config.ethAddr];if(n&&o){let a=p.weiToToken(t.params[0].value,n),r=p.weiToToken(t.params[1].value,o),i=p.weiToEth(e.value),l=Number(t.params[2].value);return{type:"Add Liquidity",exchange:"Uniswap",minimum:a,liqToken:n,amount:i,token:s,maximum:r,"token ":o,deadline:l=p.formatDate(p.toDateTime(l),!1,!1)}}}else if("removeLiquidity"==t.name){let e=this.uniqueTokens[r],a=this.uniqueTokens[this.config.uniswapContracts[r]],n=this.uniqueTokens[this.config.ethAddr];if(e&&a){let r=p.weiToToken(t.params[0].value,e),o=p.weiToToken(t.params[1].value,a),s=p.weiToToken(t.params[2].value,a),i=Number(t.params[3].value);return{type:"Remove Liquidity",exchange:"Uniswap",amount:r,liqToken:e,minimum:o,token:n,"minimum ":s,"token ":a,deadline:i=p.formatDate(p.toDateTime(i),!1,!1)}}}else{if("depositAndApprove"===t.name){let a=[],r=this.setToken(e.to);{let t=p.toBigNumber(e.value),n=this.setToken(this.config.ethAddr),o=p.weiToEth(t);a.push({type:"Wrap ETH","token In":n,"token Out":r,note:"Wrap ETH to a token",amount:o})}{let e=t.params[0].value,o=t.params[1].value,s="unknown ",i=this.addressName(e);i!==e&&(s=i);let l=p.weiToToken(o,r),u=n;a.push({type:"Approve",exchange:s,note:"Now allows tokens to be transferred by "+s,token:r,amount:l,from:u,to:e,unlisted:r.unlisted})}return a}if("withdrawAndTransfer"==t.name){let a=[],r=this.setToken(e.to),o=this.setToken(this.config.ethAddr),s=p.toBigNumber(t.params[0].value),i=p.weiToToken(s,r);a.push({type:"Unwrap ETH","token In":r,"token Out":o,note:"Unwrap a token back to ETH",amount:i});{let e=t.params[1].toLowerCase(),r=n;a.push({type:"Transfer",note:"Transfer ETH",token:o,amount:i,from:r,to:e,unlisted:o.unlisted})}return a}}else{let a=r;if(!this.config.uniswapContracts[r])return void console.log("input for unknown uniswap contract "+a);let o=void 0,s=void 0,i=void 0,l=void 0,u=void 0,d="",m=!1,c=-1;if(-1!==t.name.indexOf("ethToToken"))o=this.setToken(this.config.uniswapContracts[a]),s=this.setToken(this.config.ethAddr),i=Number(t.params[1].value),l=p.toBigNumber(t.params[0].value),u=p.toBigNumber(e.value),d="Buy",-1!==t.name.indexOf("Input")&&(m=!0),c=2;else if(-1!==t.name.indexOf("tokenToEth"))o=this.setToken(this.config.uniswapContracts[a]),s=this.setToken(this.config.ethAddr),i=Number(t.params[2].value),-1==t.name.indexOf("Output")?(l=p.toBigNumber(t.params[0].value),u=p.toBigNumber(t.params[1].value)):(l=p.toBigNumber(t.params[1].value),u=p.toBigNumber(t.params[0].value),m=!0),d="Sell",c=3;else{if(-1===t.name.indexOf("tokenToToken")&&-1===t.name.indexOf("tokenToExchange"))return;{let e=4;if(-1==t.name.indexOf("Swap")&&(e=5),d="Sell",o=this.setToken(this.config.uniswapContracts[a]),-1!==t.name.indexOf("tokenToToken"))s=this.setToken(t.params[e].value);else{let a=t.params[e].value.toLowerCase();s=this.setToken(this.config.uniswapContracts[a])}i=Number(t.params[3].value),-1==t.name.indexOf("Output")?(l=p.toBigNumber(t.params[0].value),u=p.toBigNumber(t.params[1].value)):(l=p.toBigNumber(t.params[1].value),u=p.toBigNumber(t.params[0].value),m=!0),c=4}}if(o&&s){i=p.formatDate(p.toDateTime(i),!1,!1);let e=p.weiToToken(l,o),a=p.weiToToken(u,s),r=n,h=void 0;c>=0&&-1!==t.name.indexOf("Transfer")&&(h=t.params[c].value.toLowerCase());let v=p.toBigNumber(0);e.greaterThan(0)&&(v=a.div(e));let g={type:d+" up to",exchange:"Uniswap",note:p.addressLink(r,!0,!0)+" traded with Uniswap",token:o,amount:e,estAmount:e,maxPrice:v,minPrice:v,base:s,baseAmount:a,estBaseAmount:a,unlisted:o.unlisted,taker:r};return h&&h!==r&&(g.to=h,g.note+=" and transferred the funds to "+p.addressLink(h,!0,!0)),m?(delete g.estBaseAmount,delete g.amount):(delete g.baseAmount,delete g.estAmount),"Buy"==d?delete g.minPrice:delete g.maxPrice,g}}}else{if(("convert"===t.name||"change"==t.name)&&"_fromToken"==t.params[0].name){let e=[];e[0]={value:[t.params[0].value,t.params[1].value]},e[1]={value:t.params[2].value},e[2]={value:t.params[3].value},t.params=e}let a=t.params[0].value,n=this.setToken(a[0]),o=this.setToken(a[a.length-1]),s=p.weiToEth(e.value),i=this.setToken(r),l=this.setToken(c.ethAddr);if(p.isWrappedETH(o.addr)&&"0x1f573d6fb3f13d689ff844b4ce37794d79a7ff1c"===n.addr)return{type:"Wrap ETH","token In":l,"token Out":i,note:"Wrap ETH to a token",amount:s}}return}catch(e){return void console.log("unpacked input parsing exception "+e)}}function F(e){let n=e[10].value,r=e[11].value,o=a.addressFromAssetData(n,!0),s=a.addressFromAssetData(r,!0);if(o&&s){let t={orderAddresses:[e[0].value.toLowerCase(),e[1].value.toLowerCase(),o,s,e[2].value.toLowerCase(),e[3].value.toLowerCase()],orderValues:[e[4].value,e[5].value,e[6].value,e[7].value,e[8].value]};if(e.length>=14){let n=a.addressFromAssetData(e[12].value,!0),r=a.addressFromAssetData(e[13].value,!0);n&&r&&(t.orderAddresses.push(n),t.orderAddresses.push(r))}return t}"0x"==n||"0x"==r?console.log("empty asset data found"):!o&&-1!==n.indexOf("0x94cfcdd7")||!s&&-1!==r.indexOf("0x94cfcdd7")?console.log("Unsupported ZEIP23 token bundle in assetdata "+t.name):console.log("unsupported token found in assetdata "+t.name+" - "+n+" - "+r)}},g.prototype.addressFromAssetData=function(e,t=!1){if(e&&"0x"!==e&&"x"!==e.replace(/0/g,"")){let a=p.processInput(e);if(a){if("ERC20Token"==a.name||"ERC20Bridge"==a.name)return a.params[0].value.toLowerCase();if("ERC721Token"==a.name){let e=a.params[0].value.toLowerCase(),n=e+"-"+a.params[1].value;if(!this.uniqueTokens[n]){let t=this.setToken(n);this.uniqueTokens[n]=t,this.uniqueTokens[e]||(this.uniqueTokens[e]={addr:t.addr,name:t.name,decimals:t.decimals,unlisted:t.unlisted,unknown:t.unknown,erc721:!0})}return t?n:e}if("MultiAsset"==a.name){let e=a.params[1].value,n=[];for(let a=0;a<e.length;a++)n[a]=this.addressFromAssetData(e[a],t);let r=n.join("#");return this.uniqueTokens[r]={addr:r,name:"Multiple("+e.length+")",decimals:0,unlisted:!0,unknown:!1,erc721:!1,multi:!0},r}"ERC1155Assets"==a.name?console.log("unsupported ERC1155 in assetData"):"StaticCall"==a.name?console.log("unsupported StaticCall in assetData"):console.log("unsupported assetData "+a.name)}else{if("0x"==e.slice(0,2)&&42==e.length)return e.toLowerCase();console.log("could not decode assetdata")}}},g.prototype.parseRecentIdexTrade=function(e,t,a){let n=void 0,r=void 0,o=this.setToken(t.tokenBuy),s=this.setToken(t.tokenSell);"sell"==t.type?t.taker==a.toLowerCase()?(r=o,n=s):(r=s,n=o):t.taker==a.toLowerCase()?(r=s,n=o):(r=o,n=s);let i=p.toBigNumber(t.total),l=p.toBigNumber(t.amount),u=p.toBigNumber(t.price),d=t.transactionHash,m=t.type;if(m=m.charAt(0).toUpperCase()+m.slice(1),a&&(a=a.toLowerCase()),r&&n&&(a==t.maker||a==t.taker)){let e="Taker ";a==t.maker&&(e="Maker ");let o=t.date;return o=o.replace(" ","T"),o+="Z",{Status:!0,Type:e+m,Exchange:"IDEX ",Token:r,Amount:l,Price:u,Base:n,Total:i,Hash:d,Date:new Date(o),Info:window.location.origin+window.location.pathname+"/../tx.html#"+d}}},g.prototype.isBaseToken=function(e,t){return!!p.isWrappedETH(e.addr)||!p.isWrappedETH(t.addr)&&(p.isNonEthBase(e.addr)?!p.isNonEthBase(t.addr)||p.isNonEthBase(e.addr)>p.isNonEthBase(t.addr):!(p.isNonEthBase(t.addr)||e.multi&&!t.multi||e.erc721&&!t.erc721||(!e.erc721&&t.erc721,0)))},g.prototype.getExchangeName=function(e,t=""){let a=t,n=this.addressName(e,!1);return n&&n!==e.toLowerCase()&&(a=n),a},g.prototype.addressName=function(e,t){var a=e.toLowerCase();let n="";if(this.uniqueTokens[a]){if(n=this.uniqueTokens[a].name+" Contract",this.config.uniswapContracts[a]){let e=this.config.uniswapContracts[a];n=this.uniqueTokens[e]?"Uniswap ("+this.uniqueTokens[e].name+")":"Uniswap (???)"}}else if(this.config.zrxRelayers[a])n=this.config.zrxRelayers[a];else if(this.config.zrxTakers[a])n=this.config.zrxTakers[a]+" Admin";else if(this.config.admins[a])n=this.config.admins[a];else if(this.config.exchangeWallets[a])n=this.config.exchangeWallets[a];else if(-1!==this.config.bancorConverters.indexOf(a))n="Bancor";else{let e=Object.values(this.config.exchangeContracts);for(let t=0;t<e.length;t++){let r=e[t];if(r.addr===a){n=r.name;break}}}return""!==n?n+(t?" "+a:""):a},g.prototype.isTokenAddress=function(e){var t=e.toLowerCase();return!(!this.uniqueTokens[t]&&!this.uniqueTokens[e])},g.prototype.isExchangeAddress=function(e,t){let a=e.toLowerCase(),n=Object.values(this.config.exchangeContracts);for(let e=0;e<n.length;e++)if(n[e].addr===a&&(n[e].supportedDex||t))return!0;for(let e=0;e<this.config.bancorConverters.length;e++)if(a===this.config.bancorConverters[e])return!0;let r=Object.keys(this.config.uniswapContracts);for(let e=0;e<r.length;e++)if(a===r[e].toLowerCase())return!0;return!1},g.prototype.processUnpackedEvent=function(e,t,a){function n(e){for(let a=0;a<t.length;a++)if(t[a].toLowerCase()===e.toLowerCase())return!0;return!1}t?"string"==typeof t&&(t=[t]):t=[];try{if(!e||!e.events)return{error:"unknown event output"};if("Trade"!=e.name||6!=e.events.length&&7!=e.events.length||e.address===this.config.exchangeContracts.Ethen.addr)if("Order"==e.name&&7==e.events.length){b="Sell",w=void 0,B=void 0,y=e.events[6].value.toLowerCase();let t=this.setToken(e.events[0].value),a=this.setToken(e.events[2].value);this.isBaseToken(t,a)?(b="Buy",w=a,B=t):(w=t,B=a);let n=this.getExchangeName(e.address,"");if(w&&B&&w.addr&&B.addr)return A=p.toBigNumber(0),C=p.toBigNumber(0),"Sell"===b?(A=p.toBigNumber(e.events[1].value),C=p.toBigNumber(e.events[3].value)):(C=p.toBigNumber(e.events[1].value),A=p.toBigNumber(e.events[3].value)),O=p.weiToToken(A,w),D=p.weiToToken(C,B),S=p.toBigNumber(0),O.greaterThan(0)&&(S=D.div(O)),{type:b+" offer",exchange:n,note:p.addressLink(y,!0,!0)+"placed an on-chain order.",token:w,amount:O,price:S,base:B,baseAmount:D,unlisted:w.unlisted,maker:y}}else if("Trade"==e.name&&"0xa1b5eedc73a978d181d1ea322ba20f0474bb2a25"==e.address){b="Buy",w=void 0,B=void 0,x="Taker";let t=this.setToken(e.events[1].value),a=this.setToken(e.events[3].value);A=p.toBigNumber(0),C=p.toBigNumber(0),this.isBaseToken(t,a)?(b="Sell",w=a,B=t,A=p.toBigNumber(e.events[0].value),C=p.toBigNumber(e.events[2].value)):(w=t,B=a,C=p.toBigNumber(e.events[2].value),A=p.toBigNumber(e.events[0].value));let n=this.getExchangeName(e.address,"");if(w&&B&&w.addr&&B.addr){O=p.weiToToken(A,w),D=p.weiToToken(C,B),S=p.toBigNumber(0),O.greaterThan(0)&&(S=D.div(O));let e=p.toBigNumber(0),t="";return{type:"Taker "+b,exchange:n,note:"OasisDex expiringMarket trade",token:w,amount:O,price:S,base:B,baseAmount:D,unlisted:w.unlisted,fee:e,feeCurrency:t,transType:x,tradeType:b}}}else{if("Order"==e.name&&8==e.events.length&&e.address==this.config.exchangeContracts.Ethen.addr&&e.combinedEvents){b="Sell",w=this.setToken(e.combinedEvents[2].value),B=this.setToken(this.config.ethAddr),y=e.events[0].value.toLowerCase(),N=e.combinedEvents[0].value.toLowerCase(),L="",E="",Number(e.combinedEvents[1].value)>0?(b="Buy",L=N,E=y):(E=N,L=y),x="Taker",n(y)&&(x="Maker");let t=this.getExchangeName(e.address,""),a=p.toBigNumber(e.events[3].value),r=p.toBigNumber(e.events[2].value);O=p.weiToToken(a,w),r=p.weiToToken(r,B);let o=_delta.divisorFromDecimals(B.decimals-w.decimals);r=p.weiToEth(r,o),D=O.times(r),n(L)?b="Buy":n(E)&&(b="Sell"),p.toBigNumber(25e8),p.toBigNumber(0),p.toBigNumber(1e18);let s=p.toBigNumber(e.events[7].value),i=B;return"Taker"===x?"Sell"===b?s=p.weiToToken(s,w):"Buy"===b&&(s=p.weiToToken(s,B)):"Maker"===x&&(s=p.toBigNumber(0)),{type:x+" "+b,exchange:t,note:p.addressLink(N,!0,!0)+" selected an order in the orderbook to trade.",token:w,amount:O,price:r,base:B,baseAmount:D,unlisted:w.unlisted,buyer:L,seller:E,fee:s,feeCurrency:i,transType:x,tradeType:b}}if("Match"==e.name&&2===e.events.length){let t="Sell",a=e.events[1].value[0].toLowerCase(),r=e.events[1].value[1].toLowerCase(),o=e.events[1].value[2].toLowerCase(),s=void 0;o===a?s=r:(t="Buy",s=a);let i=e.events[0].value[2].toLowerCase(),l=this.setToken(e.events[0].value[1]),u=this.setToken(e.events[0].value[0]),d=p.toBigNumber(e.events[1].value[9]),m=p.toBigNumber(e.events[1].value[8]),c="Taker";n(a)&&(c="Maker",t=o===a?"Buy":"Sell");let h=p.relayName(i,"DDEX");if(u&&l&&u.addr&&l.addr){let n=p.weiToToken(m,u),v=p.weiToToken(d,l),g=p.toBigNumber(0);n.greaterThan(0)&&(g=v.div(n));let k=l,f=p.toBigNumber(0);if("Maker"===c){let t=p.toBigNumber(e.events[1].value[3]),a=p.toBigNumber(e.events[1].value[6]),n=p.toBigNumber(e.events[1].value[4]);f=(f=(f=p.weiToToken(t,l)).plus(p.weiToToken(a,l))).minus(p.weiToToken(n,l))}else{let t=p.toBigNumber(e.events[1].value[5]),a=p.toBigNumber(e.events[1].value[7]);f=(f=p.weiToToken(t,l)).plus(p.weiToToken(a,l))}return{type:c+" "+t,exchange:h,note:p.addressLink(r,!0,!0)+" selected "+p.addressLink(a,!0,!0)+"'s order in the orderbook to trade.",token:u,amount:n,price:g,base:l,baseAmount:v,unlisted:u.unlisted,buyer:o,seller:s,fee:f,feeCurrency:k,transType:c,tradeType:t,relayer:i}}}else if("Match"==e.name){let t=e.events[3].value.toLowerCase(),a=e.events[4].value.toLowerCase(),r=e.events[2].value.toLowerCase(),o=this.setToken(e.events[1].value),s=this.setToken(e.events[0].value),i=p.toBigNumber(e.events[6].value),l=p.toBigNumber(e.events[5].value),u="Taker";n(t)&&(u="Maker");let d=p.relayName(r,"DDEX");if(s&&o&&s.addr&&o.addr){let n=p.weiToToken(l,s),m=p.weiToToken(i,o),c=p.toBigNumber(0);n.greaterThan(0)&&(c=m.div(n));let h=o,v=p.toBigNumber(0);if("Maker"===u){let t=p.toBigNumber(e.events[7].value),a=p.toBigNumber(e.events[9].value),n=p.toBigNumber(e.events[10].value);v=(v=(v=p.weiToToken(t,o)).plus(p.weiToToken(a,o))).minus(p.weiToToken(n,o))}else{let t=p.toBigNumber(e.events[8].value),a=p.toBigNumber(e.events[11].value);v=(v=p.weiToToken(t,o)).plus(p.weiToToken(a,o))}return{type:u+" Trade",exchange:d,note:p.addressLink(a,!0,!0)+" selected "+p.addressLink(t,!0,!0)+"'s order in the orderbook to trade.",token:s,amount:n,price:c,base:o,baseAmount:m,unlisted:s.unlisted,maker:t,taker:a,fee:v,feeCurrency:h,transType:u,tradeType:b,relayer:r}}}else if("LogError"==e.name&&e.events&&2==e.events.length){const t=["ORDER_EXPIRED","ORDER_FULLY_FILLED_OR_CANCELLED","ROUNDING_ERROR_TOO_LARGE","INSUFFICIENT_BALANCE_OR_ALLOWANCE"];let a=Number(e.events[0].value);if(a<t.length)return{type:"0x Error",description:t[a]}}else if("Failed"==e.name){const t=["","The makeAddress and takerAddress must be different","The order has expired","This order has already been filled","The ether sent with this transaction does not match takerAmount","No ether is required for a trade between tokens","The sender of this transaction must match the takerAddress","Order has already been cancelled or filled"];let a=Number(e.events[0].value);if(a<t.length)return{type:"AirSwap Error",description:t[a]}}else if("Canceled"===e.name||"Filled"===e.name){let t=e.events[0].value.toLowerCase(),a=e.events[3].value.toLowerCase(),r=this.setToken(e.events[2].value),o=this.setToken(e.events[5].value),s=p.toBigNumber(e.events[1].value),i=p.toBigNumber(e.events[4].value);b="Sell",w=void 0,B=void 0,x="Taker",n(t)&&(x="Maker"),this.isBaseToken(o,r)?(b="Buy",w=r,B=o):(b="Sell",w=o,B=r);let l=this.getExchangeName(e.address,"");if(w&&B&&w.addr&&B.addr)return A=p.toBigNumber(0),C=p.toBigNumber(0),L="",E="","Sell"===b?(A=i,C=s,E=a,L=t):(C=i,A=s,E=t,L=a),O=p.weiToToken(A,w),D=p.weiToToken(C,B),S=p.toBigNumber(0),O.greaterThan(0)&&(S=D.div(O)),"Filled"===e.name?{type:x+" "+b,exchange:l,note:p.addressLink(a,!0,!0)+" selected "+p.addressLink(t,!0,!0)+"'s order.",token:w,amount:O,price:S,base:B,baseAmount:D,unlisted:w.unlisted,buyer:L,seller:E,fee:p.toBigNumber(0),feeCurrency:void 0,transType:x,tradeType:b}:{type:"Cancel "+b,exchange:l,note:"Cancelled an open order",token:w,amount:O,price:S,base:B,baseAmount:D,unlisted:w.unlisted}}else if("ExecuteTrade"===e.name){let t=e.events[0].value.toLowerCase(),a="",r=this.setToken(e.events[2].value),o=this.setToken(e.events[1].value),s=p.toBigNumber(e.events[3].value),i=p.toBigNumber(e.events[4].value);b="Sell",w=void 0,B=void 0,x="Taker",n(a)&&(x="Maker"),this.isBaseToken(o,r)?(b="Buy",w=r,B=o):(b="Sell",w=o,B=r);let l=this.getExchangeName(e.address,"");if(w&&B&&w.addr&&B.addr)return A=p.toBigNumber(0),C=p.toBigNumber(0),L="",E="","Sell"===b?(A=s,C=i,E=t,L=a):(C=s,A=i,E=a,L=t),O=p.weiToToken(A,w),D=p.weiToToken(C,B),S=p.toBigNumber(0),O.greaterThan(0)&&(S=D.div(O)),{type:x+" "+b,exchange:l,note:p.addressLink(t,!0,!0)+"performed a trade.",token:w,amount:O,price:S,base:B,baseAmount:D,unlisted:w.unlisted,buyer:L,seller:E,fee:p.toBigNumber(0),feeCurrency:void 0,transType:x,tradeType:b}}else if("LogFill"==e.name||"Fill"==e.name){const t="0xdcdb42c9a256690bd153a7b409751adfc8dd5851"==e.address.toLowerCase();let a,r,o,s,i,l,u,d,m,c,h,v,g,k;if(g=v=this.setToken("0xe41d2489571d322189246dafa5ebde1f4699f498"),"LogFill"==e.name)a=e.events[0].value.toLowerCase(),r=e.events[1].value.toLowerCase(),c=void 0,o=this.setToken(e.events[3].value),s=this.setToken(e.events[4].value),i=p.toBigNumber(e.events[5].value),l=p.toBigNumber(e.events[6].value),u=p.weiToToken(e.events[7].value,v),d=p.weiToToken(e.events[8].value,g),m=e.events[2].value.toLowerCase(),t&&(v=s,g=s,h=l.div(400),u=p.weiToToken(h,v));else{let t,n,h,f,T,b;if(a=e.events[0].value.toLowerCase(),m=e.events[1].value.toLowerCase(),11==e.events.length)r=e.events[2].value.toLowerCase(),c=e.events[3].value.toLowerCase(),t=this.addressFromAssetData(e.events[9].value,!0),n=this.addressFromAssetData(e.events[10].value,!0),h="0xe41d2489571d322189246dafa5ebde1f4699f498",f="0xe41d2489571d322189246dafa5ebde1f4699f498",i=p.toBigNumber(e.events[4].value),l=p.toBigNumber(e.events[5].value),T=p.toBigNumber(e.events[6].value),b=p.toBigNumber(e.events[7].value);else{if(14!=e.events.length)return{error:"unsupported amount of Fill params"};r=e.events[7].value.toLowerCase(),c=e.events[8].value.toLowerCase(),t=this.addressFromAssetData(e.events[2].value,!0),n=this.addressFromAssetData(e.events[3].value,!0),h=this.addressFromAssetData(e.events[4].value,!0),f=this.addressFromAssetData(e.events[5].value,!0),i=p.toBigNumber(e.events[9].value),l=p.toBigNumber(e.events[10].value),T=p.toBigNumber(e.events[11].value),b=p.toBigNumber(e.events[12].value),k=p.toBigNumber(e.events[13].value)}if(!t||!n)return{error:"unsupported AssetData token in trade"};o=this.setToken(t),s=this.setToken(n),h?(v=this.setToken(h),u=p.weiToToken(T,v)):u=p.toBigNumber(0),f?(g=this.setToken(f),d=p.weiToToken(b,g)):d=p.toBigNumber(0)}r&&m===this.config.ethAddr&&(m=r,c&&c!==this.config.ethAddr&&(m=c));let f=p.relayName(m),T="Sell",b=void 0,w=void 0,B="Taker";if(n(a)&&(B="Maker"),this.isBaseToken(s,o)?(T="Buy",b=o,w=s):(T="Sell",b=s,w=o),b&&w&&b.addr&&w.addr){let e=p.toBigNumber(0),o=p.toBigNumber(0),c="",y="";"Sell"===T?(e=l,o=i,y=r,c=a):(o=l,e=i,y=a,c=r);let N=p.weiToToken(e,b),x=p.weiToToken(o,w),A=p.toBigNumber(0);N.greaterThan(0)&&(A=x.div(N)),t&&("Sell"===T?(e=l.minus(h),N=p.weiToToken(e,b)):(o=l.minus(h),x=p.weiToToken(o,w))),b.erc721&&(x=(N=p.toBigNumber(1)).times(A)),w.erc721&&(x=p.toBigNumber(1),b.erc721&&(A=p.toBigNumber(1)));let C=this.setToken(this.config.ethAddr),L=p.toBigNumber(0);k&&(L=p.weiToToken(k,C));let E=p.toBigNumber(0),O=void 0;"Maker"===B?(E=u,O=v):(E=d,O=g,k&&(d&&0!=Number(d)?d&&p.isWrappedETH(g.addr)&&(E=L.plus(d),O=C):(E=L,O=C))),t&&(O=s),n(c)?T="Buy":n(y)&&(T="Sell");let D={type:B+" "+T,exchange:f,note:p.addressLink(r,!0,!0)+" selected "+p.addressLink(a,!0,!0)+"'s order in the orderbook to trade.",token:b,amount:N,price:A,base:w,baseAmount:x,unlisted:b.unlisted,buyer:c,seller:y,fee:E,makerFee:u,feeCurrency:O,transType:B,tradeType:T,relayer:m};return t||delete D.makerFee,D}}else if("Conversion"==e.name||"Change"==e.name){let t,n,o,s=!1;"_fromToken"==e.events[0].name?(t=e.events[2].value.toLowerCase(),n=this.setToken(e.events[1].value),o=this.setToken(e.events[0].value),"Change"==e.name&&a&&t==e.address.toLowerCase()&&(t=a)):(t=e.events[5].value.toLowerCase(),n=this.setToken(e.events[2].value),o=this.setToken(e.events[1].value),s=!0);let i=p.toBigNumber(e.events[4].value),l=p.toBigNumber(e.events[3].value);var r="Bancor ";if(b="Sell",w=void 0,B=void 0,x="Taker",s||("???"===n.name&&"???"!==o.name?n.name="??? RelayBNT":"???"===o.name&&"???"!==n.name&&(o.name="??? RelayBNT")),this.isBaseToken(o,n)||"BNT"!==n.name&&(smartRelays[o.addr]||"??? RelayBNT"===o.name)?(b="Buy",w=n,B=o):(b="Sell",w=o,B=n),w&&B&&w.addr&&B.addr){A=p.toBigNumber(0),C=p.toBigNumber(0),L="",E="","Sell"===b?(A=l,C=i,E=t,L=y):(C=l,A=i,E=y,L=t),O=p.weiToToken(A,w),D=p.weiToToken(C,B),S=p.toBigNumber(0),O.greaterThan(0)&&(S=D.div(O));let a="",o="";if(!s&&(8==e.events.length||6==e.events.length)){o=n;let t=p.toBigNumber(e.events[5].value);a=w==n?p.weiToToken(t,w):p.weiToToken(t,B)}return{type:x+" "+b,exchange:r,note:p.addressLink(t,!0,!0)+" made a Bancor conversion.",token:w,amount:O,price:S,base:B,baseAmount:D,unlisted:w.unlisted,buyer:L,seller:E,fee:a,feeCurrency:o,transType:x,tradeType:b}}}else{if("XTransfer"==e.name){let t=e.events[0].value.toLowerCase(),a=e.events[3].value,n=this.setToken("0x1f573d6fb3f13d689ff844b4ce37794d79a7ff1c"),r=h.utils.parseBytes32String(e.events[1].value).trim(),o=h.utils.parseBytes32String(e.events[2].value).trim();return{type:"Transfer (cross-chain)",exchange:"BancorX",note:"Cross-chain token transfer of BNT to "+r,token:n,amount:p.weiToToken(a,n),from:t,blockchain:r,chainDestination:o,unlisted:n.unlisted}}if("TxReport"==e.name){let t=e.events[3].value.toLowerCase(),a=e.events[4].value,n=this.setToken("0x1f573d6fb3f13d689ff844b4ce37794d79a7ff1c"),r=h.utils.parseBytes32String(e.events[1].value).trim();return{type:"Transfer (cross-chain)",exchange:"BancorX",note:"Cross-chain token transfer of BNT from "+r,token:n,amount:p.weiToToken(a,n),blockchain:r,to:t,unlisted:n.unlisted}}if(e.events.length>=4&&("Deposit"==e.name||"Withdraw"==e.name)){var o=e.name,s=(w=this.setToken(e.events[0].value),e.events[1].value),i=(A=e.events[2].value,e.events[3].value);let t=this.getExchangeName(e.address,"");if(w&&w.addr){O=p.weiToToken(A,w);var l=p.weiToToken(i,w);return k="Withdraw"===e.name?"Withdrawn from the ":"Deposited into the ",k+=t?t+"contract":"exchange contract",w.addr!==this.config.ethAddr&&(o="Token "+o),{type:o,exchange:t,note:k,token:w,amount:O,balance:l,unlisted:w.unlisted}}}else if("LogDeposit"==e.name||"LogWithdrawal"==e.name||"LogDirectWithdrawal"==e.name||"LogSingleSigWithdrawal"==e.name){let t=e.name;t=(t=(t=(t=t.replace("Log","")).replace("Direct","")).replace("SingleSig","")).replace("wal","w");let a=this.setToken(e.events[1].value),n=(e.events[0].value,e.events[2].value),r=this.getExchangeName(e.address,"");if(a&&a.addr){let e=p.weiToToken(n,a);return k="Withdraw"===t?"Withdrawn from ":"Deposited into ",k+=r||"the exchange contract",a.addr!==this.config.ethAddr&&(t="Token "+t),{type:t,exchange:r,note:k,token:a,amount:e,balance:"",unlisted:a.unlisted}}}else if("DepositEther"==e.name||"WithdrawEther"==e.name||"WithdrawToken"==e.name||"DepositToken"==e.name){s=e.events[0].value.toLowerCase(),A=void 0,i=void 0,w=void 0,o=e.name,-1!==e.name.indexOf("Ether")?(w=this.setToken(this.config.ethAddr),A=e.events[1].value,i=e.events[2].value,o=o.replace("Ether","")):(w=this.setToken(e.events[1].value),A=e.events[2].value,i=e.events[3].value,o=o.replace("Token",""));let t=this.getExchangeName(e.address,"");if(w&&w.addr)return O=p.weiToToken(A,w),l=p.weiToToken(i,w),k="Withdraw"===e.name?"Withdrawn from the ":"Deposited into the ",k+=t?t+"contract":"exchange contract",w.addr!==this.config.ethAddr&&(o="Token "+o),{type:o,exchange:t,note:k,token:w,amount:O,balance:l,unlisted:w.unlisted}}else if("BalanceIncrease"==e.name||"BalanceDecrease"==e.name){const t={1:"Deposit",2:"Maker Trade",3:"Taker Trade",4:"Fee",5:"Taker Trade",6:"Maker Trade",7:"Fee",8:"Cancel",9:"Withdraw",16:"Fee",17:"Fee",18:"Fee",19:"Fee",20:"Fee",21:"Fee"};let a=e.events[0].value.toLowerCase(),n=this.setToken(e.events[1].value),r=this.getExchangeName(e.address,"");if(n&&n.addr){let o=e.events[2].value,s=p.weiToToken(o,n),i="";i="BalanceIncrease"==e.name?"+":"-";let l=Number(e.events[3].value);return{type:l=t[l]?t[l]:"",change:i,exchange:r,note:"Updated the exchange balance",token:n,amount:s,wallet:a,unlisted:n.unlisted}}}else if(p.isWrappedETH(e.address.toLowerCase())&&1==e.events.length&&("Destruction"==e.name||"Issuance"==e.name)||2==e.events.length&&("Deposit"==e.name||"Withdrawal"==e.name)){o="",w=this.setToken(e.address);var u=this.setToken(this.config.ethAddr);if(s="",A=p.toBigNumber(0),2==e.events.length?(s=e.events[0].value,A=p.toBigNumber(e.events[1].value)):A=p.toBigNumber(e.events[0].value),w&&w.addr){O=p.weiToEth(A);var d=void 0,m=void 0;return"Withdrawal"===e.name||"Destruction"===e.name?(o="Unwrap ETH",k="Unwrap WETH back to ETH",d=w,m=u):(o="Wrap ETH",k="Wrap ETH to WETH",d=u,m=w),{type:o,note:k,"token In":d,"token Out":m,amount:O,unlisted:w.unlisted,wallet:s}}}else{if("Destruction"==e.name||"Issuance"==e.name){let t=this.setToken(e.address),a="";return t&&(a=p.weiToEth(p.toBigNumber(e.events[0].value))),void e.name}if("Cancel"==e.name&&1==e.events.length&&"orderHash"==e.events[0].name)return{type:"Cancel order",exchange:this.getExchangeName(e.address,""),orderHash:e.events[0].value};if("Cancel"==e.name){if("makerAddress"===e.events[0].name){let t=4,a=5,n=2;"makerAssetData"==e.events[2].name&&(t=2,a=3,n=4);let r=e.events[t].value,o=e.events[a].value,s=this.addressFromAssetData(r,!0),i=this.addressFromAssetData(o,!0);if(s&&i){let t=e.events[0].value.toLowerCase(),a=e.events[n].value.toLowerCase(),r=this.setToken(s),o=this.setToken(i),l=r,u=o;this.isBaseToken(o,r)&&(l=o,u=r);let d=e.events[1].value.toLowerCase();return a&&d===this.config.ethAddr&&(d=a),{type:"Cancel",exchange:p.relayName(d),note:"Cancelled an open order",token:u,base:l,maker:t,unlisted:u.unlisted}}return{error:"unsupported ERC721 trade"}}{var c="sell";w=void 0,B=void 0;let t=this.setToken(e.events[0].value),a=this.setToken(e.events[2].value);this.isBaseToken(t,a)?(c="buy",w=a,B=t):(w=t,B=a);let n=this.getExchangeName(e.address,"");if(w&&B&&w.addr&&B.addr)return A=p.toBigNumber(0),C=p.toBigNumber(0),"sell"===c?(A=p.toBigNumber(e.events[1].value),C=p.toBigNumber(e.events[3].value)):(C=p.toBigNumber(e.events[1].value),A=p.toBigNumber(e.events[3].value)),O=p.weiToToken(A,w),D=p.weiToToken(C,B),S=p.toBigNumber(0),O.greaterThan(0)&&(S=D.div(O)),{type:"Cancel "+c,exchange:n,note:"Cancelled an open order",token:w,amount:O,price:S,base:B,baseAmount:D,unlisted:w.unlisted}}}else{if("CancelUpTo"==e.name){let t=Number(e.events[2].value);return{type:"Cancel up to",exchange:this.getExchangeName(e.address,"0x Exchange"),tokens:"All",note:"Cancelled all 0x orders placed up to a certain moment",orderEpoch:t}}if("LogCancel"==e.name){let t=e.events[0].value.toLowerCase(),a=e.events[1].value.toLowerCase(),n=this.setToken(e.events[2].value),o=this.setToken(e.events[3].value),s=p.toBigNumber(e.events[4].value),i=p.toBigNumber(e.events[5].value);if(b="Sell",w=void 0,B=void 0,r="",r=p.relayName(a),this.isBaseToken(o,n)?(b="Buy",w=n,B=o):(b="Sell",w=o,B=n),w&&B&&w.addr&&B.addr)return A=p.toBigNumber(0),C=p.toBigNumber(0),"Sell"===b?(A=i,C=s):(C=i,A=s),O=p.weiToToken(A,w),D=p.weiToToken(C,B),S=p.toBigNumber(0),O.greaterThan(0)&&(S=D.div(O)),{type:"Cancel "+b,exchange:r,note:p.addressLink(t,!0,!0)+"Cancelled an open order in the orderbook.",token:w,amount:O,price:S,base:B,baseAmount:D,unlisted:w.unlisted,relayer:a}}else if("LogKill"==e.name||"LogMake"==e.name){let t=e.events[2].value.toLowerCase(),a=this.setToken(e.events[4].value),n=this.setToken(e.events[3].value),r=p.toBigNumber(e.events[6].value),o=p.toBigNumber(e.events[5].value);b="Sell",w=void 0,B=void 0;let s=this.getExchangeName(e.address,"");if(this.isBaseToken(n,a)?(b="Buy",w=a,B=n):(b="Sell",w=n,B=a),w&&B&&w.addr&&B.addr)return A=p.toBigNumber(0),C=p.toBigNumber(0),"Sell"===b?(A=o,C=r):(C=o,A=r),O=p.weiToToken(A,w),D=p.weiToToken(C,B),S=p.toBigNumber(0),O.greaterThan(0)&&(S=D.div(O)),"LogKill"==e.name?{type:"Cancel "+b,exchange:s,note:p.addressLink(t,!0,!0)+"Cancelled an open order in the orderbook.",token:w,amount:O,price:S,base:B,baseAmount:D,unlisted:w.unlisted}:{type:b+" offer",exchange:s,note:p.addressLink(t,!0,!0)+"Placed an order in the orderbook.",token:w,amount:O,price:S,base:B,baseAmount:D,unlisted:w.unlisted}}else if("LogTake"==e.name){let t=e.events[2].value.toLowerCase(),a=this.setToken(e.events[3].value),r=this.setToken(e.events[4].value),o=e.events[5].value.toLowerCase(),s=p.toBigNumber(e.events[6].value),i=p.toBigNumber(e.events[7].value),l="",u=p.toBigNumber(0),d=this.getExchangeName(e.address,"");if(b="Sell",w=void 0,B=void 0,x="Taker",n(t)&&(x="Maker"),this.isBaseToken(r,a)?(b="Buy",w=a,B=r):(b="Sell",w=r,B=a),w&&B&&w.addr&&B.addr)return A=p.toBigNumber(0),C=p.toBigNumber(0),L="",E="","Sell"===b?(A=i,C=s,E=o,L=t):(C=i,A=s,E=t,L=o),O=p.weiToToken(A,w),D=p.weiToToken(C,B),S=p.toBigNumber(0),O.greaterThan(0)&&(S=D.div(O)),n(L)?b="Buy":n(E)&&(b="Sell"),{type:x+" "+b,exchange:d,note:p.addressLink(o,!0,!0)+" selected "+p.addressLink(t,!0,!0)+"'s order in the orderbook to trade.",token:w,amount:O,price:S,base:B,baseAmount:D,unlisted:w.unlisted,buyer:L,seller:E,fee:u,feeCurrency:l,transType:x,tradeType:b}}else{if("Transfer"==e.name){var v=e.events[0].value.toLowerCase(),g=e.events[1].value.toLowerCase();A=e.events[2].value,w=this.setToken(e.address),O=void 0,w.erc721||w.unknown&&"tokenId"==e.events[2].name?(O=p.toBigNumber(1),w=this.setToken(w.addr+"-"+A)):O=p.weiToToken(A,w);var k="Transferred "+O.toString()+" "+w.name;return{type:"Transfer",note:k,token:w,amount:O,from:v,to:g,unlisted:w.unlisted}}if("Approval"==e.name&&"0x96477a1c968a0e64e53b7ed01d0d6e4a311945c2"!==e.address){var f=e.events[0].value.toLowerCase();g=e.events[1].value.toLowerCase(),A=e.events[2].value,w=this.setToken(e.address),O=void 0,w.erc721||w.unknown&&"tokenId"==e.events[2].name?(O=p.toBigNumber(1),w=this.setToken(w.addr+"-"+A)):O=p.weiToToken(A,w);let t=this.getExchangeName(g,"unknown ");return"unknown "===t&&this.getExchangeName(f,"unknown "),{type:"Approve",exchange:t,note:"Now allows tokens to be transferred by "+t,token:w,amount:O,from:f,to:g,unlisted:w.unlisted}}if("ApprovalForAll"==e.name){f=e.events[0].value.toLowerCase(),g=e.events[1].value.toLowerCase();var T=e.events[2].value;(w=this.setToken(e.address)).erc721||(w.erc721=!0,w.decimals=0,this.uniqueTokens[w.addr]=w);let t=this.getExchangeName(g,"unknown ");return"unknown "===t&&this.getExchangeName(f,"unknown "),{type:"Approve",exchange:t,note:"Approve all erc721 tokenIDs to be moved by "+t,token:w,amount:T?"All":0,from:f,to:g,unlisted:w.unlisted}}if("TakeBuyOrder"==e.name||"TakeSellOrder"==e.name){let t="",a="",r="",o="",s="",i="Taker";"TakeSellOrder"==e.name?(s="Buy",t=e.events[6].value.toLowerCase(),r=a=e.events[5].value.toLowerCase(),o=t,n(t)&&(s="Sell",i="Maker")):(s="Sell",t=e.events[5].value.toLowerCase(),o=a=e.events[6].value.toLowerCase(),r=t,n(t)&&(s="Buy",i="Maker"));let l=this.setToken(this.config.ethAddr),u=this.setToken(e.events[1].value),d=this.getExchangeName(e.address,"");if(u&&l){let n=p.weiToToken(e.events[2].value,u),m=p.toBigNumber(e.events[3].value),c=p.weiToToken(m,l);S=p.toBigNumber(0),n.greaterThan(0)&&(S=c.div(n)),"TakeSellOrder"==e.name&&e.events[3].value!==e.events[4].value?n=(c=p.weiToToken(e.events[4].value,l)).div(S):"TakeBuyOrder"==e.name&&e.events[2].value!==e.events[4].value&&(c=(n=p.weiToToken(e.events[4].value,u)).times(S));let h=p.toBigNumber(0);if(Number(e.blockNumber)>1e7){const e=p.toBigNumber(25e14),t=p.toBigNumber(0),a=p.toBigNumber(1e18);let n=h;(n="Maker"==i?t:e).greaterThan(0)&&(h=p.weiToToken(m.times(n).div(a),l))}return{type:i+" "+s,exchange:d,note:p.addressLink(a,!0,!0)+" selected "+p.addressLink(t,!0,!0)+"'s order in the orderbook to trade.",token:u,amount:n,price:S,base:l,baseAmount:c,unlisted:u.unlisted,buyer:r,seller:o,feeCurrency:l,fee:h,transType:i,tradeType:s}}}else if("MakeSellOrder"==e.name||"MakeBuyOrder"==e.name||"CancelSellOrder"==e.name||"CancelBuyOrder"==e.name){let t=this.setToken(this.config.ethAddr),a=this.setToken(e.events[1].value),n="";n=-1!==e.name.indexOf("Sell")?"Sell":"Buy";let r=e.events[4].value.toLowerCase(),o=this.getExchangeName(e.address,"");if(t&&a){let s=p.weiToToken(e.events[2].value,a),i=p.weiToToken(e.events[3].value,t);return S=p.toBigNumber(0),s.greaterThan(0)&&(S=i.div(s)),-1==e.name.indexOf("Cancel")?{type:n+" offer",exchange:o,note:p.addressLink(r,!0,!0)+" created a trade offer",token:a,amount:s,price:S,base:t,baseAmount:i,unlisted:a.unlisted,maker:r,transType:"Maker",tradeType:n}:{type:"Cancel "+n,exchange:o,note:p.addressLink(r,!0,!0)+" cancelled a trade offer",token:a,amount:s,price:S,base:t,baseAmount:i,unlisted:a.unlisted,maker:r}}}else if("Buy"!=e.name&&"Sell"!=e.name&&"FillBuyOrder"!=e.name&&"FillSellOrder"!=e.name||7!=e.events.length)if("TokenPurchase"==e.name||"EthPurchase"==e.name){let t=e.address.toLowerCase();if(this.config.uniswapContracts[t]){let a=this.uniqueTokens[this.config.ethAddr],n=this.uniqueTokens[this.config.uniswapContracts[t]],r=e.events[0].value.toLowerCase(),o=void 0,s=void 0,i="Sell",l="",u="";"TokenPurchase"==e.name?(i="Buy",o=p.weiToToken(e.events[1].value,a),s=p.weiToToken(e.events[2].value,n),l=r):(o=p.weiToToken(e.events[2].value,a),s=p.weiToToken(e.events[1].value,n),u=r);let d="Uniswap",m=p.toBigNumber(0);return s.greaterThan(0)&&(m=o.div(s)),{type:"Taker "+i,exchange:d,note:p.addressLink(r,!0,!0)+"traded with Uniswap",token:n,amount:s,price:m,base:a,baseAmount:o,unlisted:n.unlisted,buyer:l,seller:u,feeCurrency:"",fee:"",transType:"Taker",tradeType:i}}console.log("trade event for unknown uniswap contract")}else if("LogTrade"==e.name||"LogSwap"==e.name){let t=this.setToken(e.events[0].value),a=p.toBigNumber(e.events[1].value),n=this.setToken(e.events[2].value),r=p.toBigNumber(e.events[3].value),o=this.getExchangeName(e.address,""),s="Sell",i=void 0,l=void 0;if(_delta.isBaseToken(n,t)?(s="Buy",i=t,l=n):(i=n,l=t),i&&l&&i.addr&&l.addr){let e=p.toBigNumber(0),t=p.toBigNumber(0);"Sell"===s?(e=r,t=a):(t=r,e=a);let n=p.weiToToken(e,i),u=p.weiToToken(t,l),d=p.toBigNumber(0);n.greaterThan(0)&&(d=u.div(n));let m="Maker";return{type:m+" "+s,exchange:o,note:"Matched 2 orders for a trade",token:i,amount:n,price:d,base:l,baseAmount:u,unlisted:i.unlisted,buyer:"",seller:"",feeCurrency:"",fee:"",transType:m,tradeType:s}}}else{if("LogTradeFailed"==e.name)return{type:"Trade error",exchange:this.getExchangeName(e.address,"unknown"),description:"Trade failed."};if("AddLiquidity"==e.name||"RemoveLiquidity"==e.name){let t=e.address.toLowerCase();if(this.config.uniswapContracts[t]){let a=this.uniqueTokens[this.config.ethAddr],n=this.uniqueTokens[this.config.uniswapContracts[t]],r=e.events[0].value.toLowerCase(),o=p.weiToToken(e.events[1].value,a),s=p.weiToToken(e.events[2].value,n),i=Number(e.events[2].value);return i=p.formatDate(p.toDateTime(i),!1,!1),{type:e.name.replace("Liq"," Liq"),amount:o,token:a,"amount ":s,"token ":n,wallet:r}}console.log("liquidity event for unknown uniswap contract")}else if("NewExchange"==e.name)return{type:"Uniswap creation",contract:e.events[1].value.toLowerCase(),tokenAddress:e.events[0].value.toLowerCase()}}else{let t=0;-1==e.name.indexOf("Fill")&&(t=1);let a=e.events[0].value.toLowerCase(),n=e.address.toLowerCase(),r="",o="",s="",i="Taker";"Buy"==e.name||"FillBuyOrder"==e.name?(s="Buy",r=a,o=n):(s="Sell",o=a,r=n);let l=this.setToken(this.config.ethAddr),u=this.setToken(e.events[1+t].value),d=this.getExchangeName(e.address,"");if(u&&l){let n=p.weiToToken(e.events[4+t].value,u),m=p.toBigNumber(e.events[5+t].value),c=p.weiToToken(m,l);return S=p.toBigNumber(0),n.greaterThan(0)&&(S=c.div(n)),p.toBigNumber(0),{type:i+" "+s,exchange:d,note:p.addressLink(a,!0,!0)+"traded through an exchange aggregator",token:u,amount:n,price:S,base:l,baseAmount:c,unlisted:u.unlisted,buyer:r,seller:o,feeCurrency:"",fee:"",transType:i,tradeType:s}}}}}}}}else{var b="Sell",w=void 0,B=void 0,y=e.events[4].value.toLowerCase(),N=e.events[5].value.toLowerCase(),x="Taker";n(y)&&(x="Maker");let t=this.setToken(e.events[0].value),a=this.setToken(e.events[2].value);this.isBaseToken(t,a)?(b="Buy",w=a,B=t):(w=t,B=a);let r=this.getExchangeName(e.address,"");if(w&&B&&w.addr&&B.addr){var A=p.toBigNumber(0),C=p.toBigNumber(0),L="",E="";"Sell"===b?(A=p.toBigNumber(e.events[1].value),C=p.toBigNumber(e.events[3].value),E=N,L=y):(C=p.toBigNumber(e.events[1].value),A=p.toBigNumber(e.events[3].value),E=y,L=N);var O=p.weiToToken(A,w),D=p.weiToToken(C,B),S=p.toBigNumber(0);O.greaterThan(0)&&(S=D.div(O)),n(L)?b="Buy":n(E)&&(b="Sell");let t=p.toBigNumber(0),a=p.toBigNumber(0);const o=p.toBigNumber(1e18);let s=this.config.exchangeContracts;if(r==s.EtherDelta.name||r==s.Decentrex.name||r==s.TokenStore.name||r==s.Singularx.name||r==s.EtherC.name)t=p.toBigNumber(3e15);else if(r==s.Enclaves.name){let a=Number(e.events[6].value);1==a?t=p.toBigNumber(3e15):0==a&&(t=p.toBigNumber(2e15))}let i=p.toBigNumber(0),l="";return"Taker"===x?"Sell"===b?(t.greaterThan(0)&&(i=p.weiToToken(A.times(t).div(o),w)),l=w):"Buy"===b&&(t.greaterThan(0)&&(i=p.weiToToken(C.times(t).div(o),B)),l=B):"Maker"===x&&("Sell"===b?(a.greaterThan(0)&&(i=p.weiToToken(A.times(a).div(o),w)),l=w):"Buy"===b&&(a.greaterThan(0)&&(i=p.weiToToken(C.times(a).div(o),B)),l=B)),{type:x+" "+b,exchange:r,note:p.addressLink(N,!0,!0)+" selected "+p.addressLink(y,!0,!0)+"'s order in the orderbook to trade.",token:w,amount:O,price:S,base:B,baseAmount:D,unlisted:w.unlisted,buyer:L,seller:E,fee:i,feeCurrency:l,transType:x,tradeType:b}}}return{error:"unknown event output"}}catch(e){return console.log("unpacked event parsing exception "+e),{error:"unknown event output"}}},g.prototype.startDeltaBalances=function(e,t){let a=this;this.loadWeb3(e,()=>{a.initContracts(()=>{t()})})},g.prototype.makeTokenPopover=function(e){if(e){let t=e.name;e.name2&&(t+=" - "+e.name2);let a="label-warning";e.unlisted||(a="label-primary"),(e.erc721||e.multi)&&(a="label-default");let n="PlaceHolder";try{if(e&&e.addr)if(p.isWrappedETH(e.addr))e.addr==this.config.ethAddr?n="Ether (not a token)<br> Decimals: 18":(n="Contract: "+p.addressLink(e.addr,!0,!0)+"<br> Decimals: "+e.decimals+"<br>Wrapped Ether",e.old?n+='<br> <i class="text-red fa fa-exclamation-triangle" aria-hidden="true"></i> Token contract is deprecated.':e.warning&&(n+='<br> <i class="text-red fa fa-exclamation-triangle" aria-hidden="true"></i> Token contract will soon be deprecated.'),(e.locked||e.killed)&&(n+='<br> <i class="text-red fa fa-lock" aria-hidden="true"></i> Token Locked or Paused.'));else{if(e.multi){t="Multiple Assets",n="This is a bundle of multiple tokens <br>";let a=e.addr.split("#");for(let e=0;e<a.length;e++){let t=this.setToken(a[e]),r=t.name;t.erc721&&t.erc721Id&&(r+="-"+t.erc721Id),n+=r+": "+p.tokenLink(t.addr,!0,!0,t.erc721Id)+"<br>"}}else e.erc721?(n="",this.uniqueTokens[e.addr]&&!e.unknown||(n+="Token unknown to DeltaBalances. <br>"),e.erc721Id?(n+="ERC721 Non-fungible token. <br> Unique Token ID: "+e.erc721Id,n+="<br>Contract: "+p.tokenLink(e.addr,!0,!0,e.erc721Id)):n+="ERC721 Non-fungible token. <br> Contract: "+p.addressLink(e.addr,!0,!0)):n=this.uniqueTokens[e.addr]?"Contract: "+p.tokenLink(e.addr,!0,!0)+"<br> Decimals: "+e.decimals:"Token unknown to DeltaBalances <br> Contract: "+p.addressLink(e.addr,!0,!0);e.old?n+='<br> <i class="text-red fa fa-exclamation-triangle" aria-hidden="true"></i> Token contract is deprecated.':e.warning&&(n+='<br> <i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Token contract will soon be deprecated.'),(e.locked||e.killed)&&(n+='<br> <i class="text-red fa fa-lock" aria-hidden="true"></i> Token Locked or Paused.'),e.erc721||e.multi||(n+='<br><br> Trade centralized: <br><table class="popoverTable"><tr><td>'+p.binanceURL(e,!0)+"</td></tr></table>",n+='Trade decentralized: <br><table class="popoverTable"><tr><td>'+p.forkDeltaURL(e,!0)+"</td><td>"+p.idexURL(e,!0)+"</td></tr><tr><td>"+p.oneInchUrl(e,!0)+"</td><td>"+p.ddexURL(e,!0)+"</td></tr><tr><td>"+p.radarURL(e,!0)+"</td><td>"+p.kyberURL(e,!0)+"</td></tr></table>",n+='Legacy decentralized: <br><table class="popoverTable"><tr><td>'+p.etherDeltaURL(e,!0)+"</td><td>"+p.tokenStoreURL(e,!0)+"</td></tr>")}}catch(e){console.log("error making popover "+e)}let r=e.name;if(e.erc721Id){let t=e.erc721Id.toString();t.length>10&&(t=t.slice(0,8)+"..."),r+=" - "+t}else e.erc721&&(r='<span class="text75">[ERC721]</span> '+r);return e.locked?r+=' <i class="fa fa-lock" aria-hidden="true"></i>':(e.old||e.warning)&&(r+=' <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>'),'<a tabindex="0" class="label '+a+'" role="button" data-html="true" data-toggle="popover" data-placement="auto right"  title="'+t+'" data-container="body" data-content=\''+n+"'>"+r+"</a>"}return console.log("undefined token in popover"),""},{DeltaBalances:v,utility:p}}));
